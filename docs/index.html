<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-03-27 Thu 12:45 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>An ABAQUS-MATLAB tutorial for Jointed Systems</title>
<meta name="author" content="Nidish Narayanaa Balaji" />
<meta name="generator" content="Org Mode" />
<base target="_blank">
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>

          <style>
          /* From: https://endlessparentheses.com/public/css/endless.css */
          /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
          kbd
          {
            -moz-border-radius: 6px;
            -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            -webkit-border-radius: 6px;
            -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            color: #333;
            display: inline-block;
            font-family: 'Droid Sans Mono', monospace;
            font-size: 80%;
            font-weight: normal;
            line-height: inherit;
            margin: 0 .1em;
            padding: .08em .4em;
            text-shadow: 0 1px 0 #fff;
            word-spacing: -4px;
        
            box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
          }
          </style>
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>
        
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />
        
          <script type="text/javascript">
              if (typeof jQuery == 'undefined') {
                  document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
              }
          </script>
        
           <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>
        
            <script>
                   $(document).ready(function() {
                       $('.tooltip').tooltipster({
                           theme: 'tooltipster-punk',
                           contentAsHTML: true,
                           animation: 'grow',
                           delay: [100,500],
                           // trigger: 'click'
                           trigger: 'custom',
                           triggerOpen: {
                               mouseenter: true
                           },
                           triggerClose: {
                               originClick: true,
                               scroll: true
                           }
           });
                   });
               </script>
        
          <style>
             abbr {color: red;}
        
             .tooltip { border-bottom: 1px dotted #000;
                        color:red;
                        text-decoration: none;}
          </style>
          
          <style>
          /* From: https://endlessparentheses.com/public/css/endless.css */
          /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
          kbd
          {
            -moz-border-radius: 6px;
            -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            -webkit-border-radius: 6px;
            -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
            color: #333;
            display: inline-block;
            font-family: 'Droid Sans Mono', monospace;
            font-size: 80%;
            font-weight: normal;
            line-height: inherit;
            margin: 0 .1em;
            padding: .08em .4em;
            text-shadow: 0 1px 0 #fff;
            word-spacing: -4px;
        
            box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
          }
          </style>
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>
        
          <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />
        
          <script type="text/javascript">
              if (typeof jQuery == 'undefined') {
                  document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
              }
          </script>
        
           <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>
        
            <script>
                   $(document).ready(function() {
                       $('.tooltip').tooltipster({
                           theme: 'tooltipster-punk',
                           contentAsHTML: true,
                           animation: 'grow',
                           delay: [100,500],
                           // trigger: 'click'
                           trigger: 'custom',
                           triggerOpen: {
                               mouseenter: true
                           },
                           triggerClose: {
                               originClick: true,
                               scroll: true
                           }
           });
                   });
               </script>
        
          <style>
             abbr {color: red;}
        
             .tooltip { border-bottom: 1px dotted #000;
                        color:red;
                        text-decoration: none;}
          </style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">An ABAQUS-MATLAB tutorial for Jointed Systems</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org792e8d7">1. Introduction</a>
<ul>
<li><a href="#orgd0a4936">1.1. Outline Presentation</a></li>
</ul>
</li>
<li><a href="#sec:prepro">2. Preprocess</a>
<ul>
<li><a href="#org9a4232a">2.1. A Note on Python Scripting&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a></li>
<li><a href="#sec:modeling">2.2. Modeling Parts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></a></li>
<li><a href="#sec:setcreat">2.3. Creating appropriate surface sets&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></a></li>
<li><a href="#orgb34b873">2.4. Create Assembly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></a></li>
</ul>
</li>
<li><a href="#sec:constr">3. Constraints</a>
<ul>
<li><a href="#orgc043826">3.1. Tie-Constraint Enforcement&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></a></li>
<li><a href="#sec:boltprel">3.2. Bolt Preload Realization&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></a></li>
</ul>
</li>
<li><a href="#sec:meshing">4. Meshing</a>
<ul>
<li><a href="#org65e4079">4.1. Meshing Instructions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></a></li>
<li><a href="#sec:abqprs">4.2. (Optional, recommended) Verify correctness of model through frictionless prestress&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></a></li>
</ul>
</li>
<li><a href="#sec:meshproc">5. Mesh Process</a>
<ul>
<li><a href="#orgfc7d660">5.1. Reorganize Interfacial Node Sets (readjust if necessary)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a></li>
<li><a href="#org14446d3">5.2. Setup Fixed interface CMS (HCB-CMS) with linear frequency and substructure steps&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a></li>
<li><a href="#org11b2ac2">5.3. Run Job and Generate the mtx file.&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></a></li>
</ul>
</li>
<li><a href="#sec:mex">6. Matrix Extraction + NL-Analysis</a>
<ul>
<li><a href="#sec:bscr">6.1. Postprocessing Exported Matrices&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a></li>
<li><a href="#sec:nlan">6.2. Nonlinear Analysis on MATLAB/OCTAVE in under 100 lines of code&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a>
<ul>
<li><a href="#orgb8e5b15">6.2.1. Plotting</a></li>
<li><a href="#org3441099">6.2.2. Miscellanies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec:relcsp">7. Relative Coordinates Pipeline</a>
<ul>
<li><a href="#sec:insrpt">7.1. Insertion of Reference Point Instances&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></a></li>
<li><a href="#orgb28f57f">7.2. Process the inp-file model, renumber the bottom nodes, and conduct HCBCMS.</a></li>
<li><a href="#orgcaaa996">7.3. Nonlinear Prestress Analysis with MATLAB/OCTAVE</a>
<ul>
<li><a href="#orgc1213a9">7.3.1. Plotting Results</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec:outro">8. Outro/Contact</a>
<ul>
<li><a href="#org6242c80">8.1. Summary</a></li>
<li><a href="#orgcbb1803">8.2. Details on this web-page documentation/offering suggestions</a></li>
</ul>
</li>
</ul>
</div>
</div>
<style> summary:hover {background:pink;} </style>
<script>var HS_STARTUP_FOLDED = true;</script>
<div id="outline-container-org792e8d7" class="outline-2">
<h2 id="org792e8d7"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This tutorial has been prepared to help researchers get started with modeling jointed systems for use in nonlinear vibration contexts.
A three-bolted lap joint system known as the Brake-Reu{\ss} Beam (read more about the benchmark <a href="https://jointmechanics.org/index.php/Benchmarks#The_Brake-Reu%C3%9F_Beams">here</a>) is used for the demonstrations.
We will start with making the model using CAD and go all the way to doing a simple nonlinear prestress calculation.
</p>

<p>
It is understood that not everyone will be interested in each step of the tutorial, so intermediate files are saved and are available in the repository.
This should help the reader start at any desired intermediate step.
</p>

<p>
Here is an overview of the sections and their contents:
</p>
<ol class="org-ol">
<li><p>
<b>Preprocessing</b> (<a href="cref:sec:prepro">cref:sec:prepro</a>): discusses the CAD modeling (<a href="cref:sec:modeling">cref:sec:modeling</a>) of the parts along with necessary set creation (<a href="cref:sec:setcreat">cref:sec:setcreat</a>). Of particular note here is the <b>realization of bolt prestress</b> (see more in <a href="cref:sec:boltprel">cref:sec:boltprel</a>), which is done in a manner that is most convenient for linear and nonlinear vibration simulations including prestress effects.
</p>

<p>
<span class="underline">The model at the end of this step can be found in <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step0.cae">model_step0.cae</a>.</span>
</p></li>
<li><p>
<b>Constraints</b> (<a href="cref:sec:constr">cref:sec:constr</a>): discusses the relevant constraints for the tied interfaces (washers are fully tied, for instance), and the bolt preload realization (<a href="cref:sec:boltprel">cref:sec:boltprel</a>).
</p>

<p>
<span class="underline">The model at the end of this step can be found in <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1.cae">model_step1.cae</a>.</span>
</p></li>
<li><p>
<b>Meshing</b> (<a href="cref:sec:meshing">cref:sec:meshing</a>): discusses the seeded meshing procedure. This section also includes instructions for an optional abaqus static prestress simulation (<a href="cref:sec:abqprs">cref:sec:abqprs</a>) that can be used to verify the correctness of the model so far.
</p>

<p>
<span class="underline">The model at the end of this step can be found in <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1a.cae">model_step1a.cae</a>. Additionally, <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step2.cae">model_step2.cae</a> is also available, which includes the above prestress test.</span>
</p></li>
<li><b>Mesh Process</b> (<a href="cref:sec:meshproc">cref:sec:meshproc</a>): discusses processing the mesh and includes selection of an output node, reorganization of node sets (so that the bottom interface nodes are right below the top), and provides instructions on setting up the Hurty/Craig-Bampton (HCB) procedure. It ends with instructions to run the job required for generating substructured matrices.</li>
<li><b>Matrix Extraction</b> (<a href="cref:sec:mex">cref:sec:mex</a>): discusses the format of the outputted matrix and provides a bash-python script to postprocess it (<a href="cref:sec:bscr">cref:sec:bscr</a>). Additionally a MATLAB/Octave tutorial is provide (<a href="cref:sec:nlan">cref:sec:nlan</a>) which conducts <b>nonlinear prestress analysis with sub-100 lines of code</b>.
<span class="underline">The model at the end of everything can be found in <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step3.cae">model_step3.cae</a>.</span></li>
<li><p>
<b>Relative Coordinates Pipeline</b> (<a href="cref:sec:relcsp">cref:sec:relcsp</a>): discusses the pipeline that needs to be followe in ABAQUS for using relative coordinate DOFS. <b>This provides an ~2x reduction in model size without any approximations</b>, and is therefore recommended always.
This is presented as a separate section since it requires some experience with ABAQUS before following all the steps that are involved here.
</p>

<p>
When the relative coordinate DOFs format is desired, <a href="cref:sec:meshproc">cref:sec:meshproc</a> and <a href="cref:sec:mex">cref:sec:mex</a> don't need to be followed. This can be substituted completely with <a href="cref:sec:relcsp">cref:sec:relcsp</a>.
</p></li>
<li><b>Outro/Contact</b> (<a href="cref:sec:outro">cref:sec:outro</a>): Concludes the tutorial, giving contact information of the authors, etc.</li>
</ol>
</div>
<div id="outline-container-orgd0a4936" class="outline-3">
<h3 id="orgd0a4936"><span class="section-number-3">1.1.</span> Outline Presentation</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The following presentation was delivered at the monthly seminar series of the <a href="https://jointmechanics.org/index.php/Main_Page">International Committee of Jointed Structures</a> in March 2025.
It provides an overview of the tutorial. You can find the file in the repository <a href="https://github.com/Nidish96/Abaqus4Joints/blob/832076ec8b4464826727a101fc5bf3c435ec9701/icjm_pres/icjm_pres.pdf">here</a>.
</p>

<embed src="./figs/icjm_pres.pdf" width="80%" height="375">
</div>
</div>
</div>
<div id="outline-container-sec:prepro" class="outline-2">
<h2 id="sec:prepro"><span class="section-number-2">2.</span> Preprocess</h2>
<div class="outline-text-2" id="text-sec:prepro">
<p>
The Brake-Reu√ü Beam (BRB) is a 3-bolted lap-joint beam which will serve as our tutorial joint structure (read more about the benchmark <a href="https://jointmechanics.org/index.php/Benchmarks#The_Brake-Reu%C3%9F_Beams">here</a>).
To make the tutorial self-contained, the tutorial will begin with CAD-modeling of the BRB in ABAQUS and take you all the way to matrix extraction and nonlinear dynamics analysis on MATLAB/OCTAVE.
Buckle up! :)
</p>


<div id="fig:brbgeom" class="figure">
<p><img src="./figs/300px-BRB.png" alt="300px-BRB.png" width="300px" class="zoomable-image" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>Geometry of the BRB Benchmark</p>
</div>

<p>
A picture of the parts of the BRB is shown in Fig. <a href="#fig:brbgeom">1</a> and this will be used to guide the modeling here.
Standard 5/16 bolt-nut-washers will be used for the assembly. Since Bolt thread interactions won't be modeled here, the bolt shank is modeled as a smooth cylinder (see <a href="cref:sec:boltprel">cref:sec:boltprel</a> for more details on bolt prestress modeling).
</p>

<p>
<b>Note</b>: If you already have a model of your structure and want to just apply the node-selection/matrix extraction, you can safely ignore the sections particular to the modeling of the BRB and just go through the remaining, whose instructions are quite general.
The general principles in the modeling section are, however, recommended for all jointed structure modeling.
</p>
</div>
<div id="outline-container-org9a4232a" class="outline-3">
<h3 id="org9a4232a"><span class="section-number-3">2.1.</span> A Note on Python Scripting&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-2-1">
<p>
ABAQUS Python scripting is quite powerful and will be used quite liberally throughout this tutorial. The following are some tips/tricks to get started for beginners:
</p>
<ul class="org-ul">
<li>For beginners, the easiest way to start scripting is to open up CAE (the GUI) and do the necessary tasks. ABAQUS would have saved the actions in a Python file called <code>abaqus.rpy</code>. This is just python code that can be imported into ABAQUS to repeat the same tasks.
All standard python commands work so this makes it very helpful.</li>
<li>On Windows the <b>work directory</b> may be an unfamiliar concept (on Linux it is just the directory from which ABAQUS is launched). This directory can be manually set by <code>File-&gt;Set Work Directory</code>, following which all the files (including the <code>ABAQUS.rpy</code> file) will be put in the specified folder.</li>
<li>Fig <a href="#fig:ovw">2</a> shows a pictorial overview of the different options available in ABAQUS for scripting support. The ABAQUS PDE can be used for ABAQUS python script development.</li>
</ul>

<div id="fig:ovw" class="figure">
<p><img src="./figs/ovw.png" alt="ovw.png" width="600px" class="zoomable-image" align="center" />
</p>
<p><span class="figure-number">Figure 2: </span>Options in ABAQUS for Scripting</p>
</div>
</div>
</div>
<div id="outline-container-sec:modeling" class="outline-3">
<h3 id="sec:modeling"><span class="section-number-3">2.2.</span> Modeling Parts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-sec:modeling">
<p>
We will first model the two "halves" of the BRB. The following steps enumerate the process (can be skipped if you already have a model).
</p>

<p>
We will do the construction through ABAQUS Python code that can be imported through <code>File-&gt;Run Script</code> or just typed into the command line.
</p>

<ol class="org-ol">
<li><p>
First import the following code to import all the necessary objects and then the material properties (steel, here).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span style="color: #8D8D84; font-style: italic;"># -*- coding: utf-8 -*-</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">import</span> sys
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">from</span> part <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">from</span> material <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">from</span> section <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">from</span> assembly <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 8: </span><span style="color: #0000FF;">from</span> step <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">from</span> interaction <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">10: </span><span style="color: #0000FF;">from</span> load <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">11: </span><span style="color: #0000FF;">from</span> mesh <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">12: </span><span style="color: #0000FF;">from</span> optimization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">13: </span><span style="color: #0000FF;">from</span> job <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">14: </span><span style="color: #0000FF;">from</span> sketch <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">15: </span><span style="color: #0000FF;">from</span> visualization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">16: </span><span style="color: #0000FF;">from</span> connectorBehavior <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdb.<span style="color: #D0372D; font-style: italic;">models</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">19: </span><span style="color: #8D8D84; font-style: italic;">##############################</span>
<span class="linenr">20: </span><span style="color: #8D8D84; font-style: italic;"># MATERIAL PROPERTIES: STEEL #</span>
<span class="linenr">21: </span><span style="color: #8D8D84; font-style: italic;">##############################</span>
<span class="linenr">22: </span>mdl.<span style="color: #6434A3; font-style: italic;">Material</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'STEEL'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #BA36A5;">steel</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">materials</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'STEEL'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">25: </span>steel.<span style="color: #6434A3; font-style: italic;">Density</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">table</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">7800.0</span>, <span style="color: #1e90ff;">)</span>, <span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">26: </span>steel.<span style="color: #6434A3; font-style: italic;">Elastic</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">table</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">2e11</span>, <span style="color: #D0372D;">0.29</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">27: </span>mdl.<span style="color: #6434A3; font-style: italic;">HomogeneousSolidSection</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">material</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'STEEL'</span>, <span style="color: #808080;">name</span><span style="color: #0000FF;">=</span>
<span class="linenr">28: </span>                            <span style="color: #008000;">'Section-1'</span>, <span style="color: #808080;">thickness</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">None</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
The above code creates a new material called "STEEL", with Young's Modulus 200GPa, Poisson's ratio 0.29, and density 7800 kg/m<sup>3</sup>.
</p></li>
<li><p>
Now use the following to model the half beam (this can be done on CAE with the GUI quite easily).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 29: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdb.<span style="color: #D0372D; font-style: italic;">models</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 30: </span>
<span class="linenr"> 31: </span><span style="color: #8D8D84; font-style: italic;">###################</span>
<span class="linenr"> 32: </span><span style="color: #8D8D84; font-style: italic;"># PART : HALFBEAM #</span>
<span class="linenr"> 33: </span><span style="color: #8D8D84; font-style: italic;">###################</span>
<span class="linenr"> 34: </span><span style="color: #8D8D84; font-style: italic;"># 1. Sketch and Extrude</span>
<span class="linenr"> 35: </span>mdl.<span style="color: #6434A3; font-style: italic;">ConstrainedSketch</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'__profile__'</span>, <span style="color: #808080;">sheetSize</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">2.0</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 36: </span><span style="color: #BA36A5;">sktch</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">sketches</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'__profile__'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 37: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">36e-2</span>, <span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">6e-2</span>, <span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 38: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">6e-2</span>, <span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">6e-2</span>, <span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 39: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">6e-2</span>, <span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #D0372D;">6e-2</span>,<span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 40: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #D0372D;">6e-2</span>,<span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #D0372D;">6e-2</span>,<span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 41: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #D0372D;">6e-2</span>,<span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">36e-2</span>,<span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 42: </span>sktch.<span style="color: #6434A3; font-style: italic;">Line</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">36e-2</span>,<span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">point2</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">36e-2</span>,<span style="color: #D0372D;">1.27e-2</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>mdl.<span style="color: #6434A3; font-style: italic;">Part</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">dimensionality</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">THREE_D</span>, <span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'HALFBEAM'</span>, <span style="color: #808080;">type</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">DEFORMABLE_BODY</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 45: </span><span style="color: #BA36A5;">hfbm</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">parts</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'HALFBEAM'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 46: </span>hfbm.<span style="color: #6434A3; font-style: italic;">BaseSolidExtrude</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">depth</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">25.4e-3</span>, <span style="color: #808080;">sketch</span><span style="color: #0000FF;">=</span>sktch<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 47: </span><span style="color: #0000FF;">del</span> sktch
<span class="linenr"> 48: </span>
<span class="linenr"> 49: </span><span style="color: #8D8D84; font-style: italic;"># 2. Cut out Holes</span>
<span class="linenr"> 50: </span>mdl.<span style="color: #6434A3; font-style: italic;">ConstrainedSketch</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'__profile__'</span>, <span style="color: #808080;">sheetSize</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">2.0</span>,
<span class="linenr"> 51: </span>                      <span style="color: #808080;">transform</span><span style="color: #0000FF;">=</span>
<span class="linenr"> 52: </span>                      hfbm.<span style="color: #6434A3; font-style: italic;">MakeSketchTransform</span><span style="color: #00ff00;">(</span>
<span class="linenr"> 53: </span>                          <span style="color: #808080;">sketchPlane</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">2</span><span style="color: #1e90ff;">]</span>,
<span class="linenr"> 54: </span>                          <span style="color: #808080;">sketchPlaneSide</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">SIDE1</span>,
<span class="linenr"> 55: </span>                          <span style="color: #808080;">sketchUpEdge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">8</span><span style="color: #1e90ff;">]</span>,
<span class="linenr"> 56: </span>                          <span style="color: #808080;">sketchOrientation</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">RIGHT</span>,
<span class="linenr"> 57: </span>                          <span style="color: #808080;">origin</span><span style="color: #0000FF;">=</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">1.27e-2</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 58: </span><span style="color: #BA36A5;">sktch</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">sketches</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'__profile__'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 59: </span><span style="color: #BA36A5;">cs</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">3e-2</span>, <span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">3e-2</span><span style="color: #00ffff; font-weight: bold;">]</span>;
<span class="linenr"> 60: </span><span style="color: #BA36A5;">gs</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[]</span>
<span class="linenr"> 61: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">3</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr"> 62: </span>    gs.<span style="color: #006DAF; font-style: italic;">append</span><span style="color: #00ffff; font-weight: bold;">(</span>sktch.<span style="color: #6434A3; font-style: italic;">CircleByCenterPerimeter</span><span style="color: #00ff00;">(</span><span style="color: #808080;">center</span><span style="color: #0000FF;">=</span><span style="color: #1e90ff;">(</span>cs<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>, <span style="color: #D0372D;">0</span><span style="color: #1e90ff;">)</span>,
<span class="linenr"> 63: </span>                                            <span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #1e90ff;">(</span>cs<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span><span style="color: #0000FF;">+</span><span style="color: #D0372D;">0.85e-2</span><span style="color: #0000FF;">/</span><span style="color: #D0372D;">2</span>, <span style="color: #D0372D;">0</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 64: </span>
<span class="linenr"> 65: </span>hfbm.<span style="color: #6434A3; font-style: italic;">CutExtrude</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">sketchPlane</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">2</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">sketchPlaneSide</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">SIDE1</span>,
<span class="linenr"> 66: </span>                <span style="color: #808080;">sketchUpEdge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">8</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 67: </span>                <span style="color: #808080;">sketchOrientation</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">RIGHT</span>, <span style="color: #808080;">sketch</span><span style="color: #0000FF;">=</span>sktch<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 68: </span>
<span class="linenr"> 69: </span>
<span class="linenr"> 70: </span><span style="color: #8D8D84; font-style: italic;"># 3. Partition object</span>
<span class="linenr"> 71: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByExtendFace</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>,
<span class="linenr"> 72: </span>                               <span style="color: #808080;">extendFace</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">6</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 73: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByExtendFace</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>,
<span class="linenr"> 74: </span>                               <span style="color: #808080;">extendFace</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">7</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span>mdl.<span style="color: #6434A3; font-style: italic;">ConstrainedSketch</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'__profile__'</span>, <span style="color: #808080;">sheetSize</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">2.0</span>,
<span class="linenr"> 77: </span>                      <span style="color: #808080;">gridSpacing</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">30e-3</span>, <span style="color: #808080;">transform</span><span style="color: #0000FF;">=</span>
<span class="linenr"> 78: </span>                      hfbm.<span style="color: #6434A3; font-style: italic;">MakeSketchTransform</span><span style="color: #00ff00;">(</span>
<span class="linenr"> 79: </span>                          <span style="color: #808080;">sketchPlane</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">11</span><span style="color: #1e90ff;">]</span>,
<span class="linenr"> 80: </span>                          <span style="color: #808080;">sketchPlaneSide</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">SIDE1</span>,
<span class="linenr"> 81: </span>                          <span style="color: #808080;">sketchUpEdge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">27</span><span style="color: #1e90ff;">]</span>,
<span class="linenr"> 82: </span>                          <span style="color: #808080;">sketchOrientation</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">RIGHT</span>,
<span class="linenr"> 83: </span>                          <span style="color: #808080;">origin</span><span style="color: #0000FF;">=</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">1.27e-2</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 84: </span><span style="color: #BA36A5;">sktch</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">sketches</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'__profile__'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 85: </span><span style="color: #BA36A5;">cs</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">3e-2</span>, <span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">3e-2</span><span style="color: #00ffff; font-weight: bold;">]</span>;
<span class="linenr"> 86: </span><span style="color: #BA36A5;">wor</span> <span style="color: #0000FF;">=</span> i2m<span style="color: #0000FF;">*</span><span style="color: #D0372D;">0.34375</span>
<span class="linenr"> 87: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">3</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr"> 88: </span>    sktch.<span style="color: #6434A3; font-style: italic;">CircleByCenterPerimeter</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">center</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span>cs<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>, <span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span>,
<span class="linenr"> 89: </span>                                  <span style="color: #808080;">point1</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span>cs<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span><span style="color: #0000FF;">+</span>wor, <span style="color: #D0372D;">0</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 90: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellBySketch</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">sketch</span><span style="color: #0000FF;">=</span>sktch,
<span class="linenr"> 91: </span>                           <span style="color: #808080;">sketchUpEdge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">27</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 92: </span>                           <span style="color: #808080;">sketchPlane</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">faces</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">11</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 93: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByExtrudeEdge</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">edges</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">0</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 94: </span>                                <span style="color: #808080;">line</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">sense</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">FORWARD</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 95: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByExtrudeEdge</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">edges</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">3</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 96: </span>                                <span style="color: #808080;">line</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">sense</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">FORWARD</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 97: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByExtrudeEdge</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">edges</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">6</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 98: </span>                                <span style="color: #808080;">line</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">sense</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">FORWARD</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 99: </span>
<span class="linenr">100: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">2</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">101: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">102: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">2</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">103: </span>
<span class="linenr">104: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">75</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">105: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">106: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">75</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">107: </span>
<span class="linenr">108: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">39</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">109: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">110: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">39</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">111: </span>
<span class="linenr">112: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">85</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">113: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">114: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">85</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">115: </span>
<span class="linenr">116: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">39</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">117: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">118: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">39</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">119: </span>
<span class="linenr">120: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">41</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">121: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">122: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">41</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">123: </span>
<span class="linenr">124: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">111</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">125: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">126: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">111</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">127: </span>
<span class="linenr">128: </span><span style="color: #BA36A5;">pt</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">InterestingPoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">edge</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">135</span><span style="color: #00ff00;">]</span>, <span style="color: #808080;">rule</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MIDDLE</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">129: </span>hfbm.<span style="color: #6434A3; font-style: italic;">PartitionCellByPlanePointNormal</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">point</span><span style="color: #0000FF;">=</span>pt,
<span class="linenr">130: </span>                                     <span style="color: #808080;">normal</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">edges</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">135</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">131: </span>
<span class="linenr">132: </span><span style="color: #8D8D84; font-style: italic;"># 4. Assign Material</span>
<span class="linenr">133: </span><span style="color: #BA36A5;">regn</span> <span style="color: #0000FF;">=</span> hfbm.<span style="color: #6434A3; font-style: italic;">Set</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">cells</span><span style="color: #0000FF;">=</span>hfbm.<span style="color: #D0372D; font-style: italic;">cells</span>, <span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">134: </span>hfbm.<span style="color: #6434A3; font-style: italic;">SectionAssignment</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>regn, <span style="color: #808080;">sectionName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Section-1'</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
</ol>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #cccccc;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Scripting note
                      </font>
                    </strong>
                  </summary>
<p>
You can see that certain faces and edges were used in the above.
A quick way to check which face is what will be to use the <code>highlight</code> command on the ABAQUS python console.
Here is an example:
</p>

<div id="org107da02" class="figure">
<p><img src="./figs/highl.png" alt="highl.png" width="600px" />
</p>
</div>


</details>
<p>
At the end of this step, you should have a partitioned part that looks like this.
The partitioning is done in this way to help with the seeded meshing, constraint enforcement, etc.
</p>

<div id="org0f8e368" class="figure">
<p><img src="./figs/parthb.png" alt="parthb.png" width="600px" />
</p>
</div>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #cccccc;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         IMPORTANT! Geometry Correction Note
                      </font>
                    </strong>
                  </summary>
<p>
You have to ensure that the curved edges on the above are, indeed, single edges. You will run into meshing issues if this is not the case.
If not, you will have to use the "Merge Edges" tool in the Part module and individually select each edge and merge them.
</p>

<div id="org57bb754" class="figure">
<p><img src="./figs/medg.png" alt="medg.png" width="600px" />
</p>
</div>


</details>
<ol class="org-ol">
<li><p>
Create a Reference Point Part called <code>REFPT</code>.
This will be necessary for the application of bolt prestress (see <a href="cref:sec:boltprel">cref:sec:boltprel</a> below).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">135: </span><span style="color: #BA36A5;">rpt</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #6434A3; font-style: italic;">Part</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'REFPT'</span>, <span style="color: #808080;">dimensionality</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">THREE_D</span>, 
<span class="linenr">136: </span>               <span style="color: #808080;">type</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">DEFORMABLE_BODY</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">137: </span>rpt.<span style="color: #6434A3; font-style: italic;">ReferencePoint</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">point</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">0.0</span>, <span style="color: #D0372D;">0.0</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">138: </span>
<span class="linenr">139: </span>rpt.<span style="color: #6434A3; font-style: italic;">Set</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Set-1'</span>, <span style="color: #808080;">referencePoints</span><span style="color: #0000FF;">=</span>rpt.<span style="color: #D0372D; font-style: italic;">referencePoints</span>.<span style="color: #006DAF; font-style: italic;">values</span><span style="color: #00ff00;">()</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Now import the nuts, washers and bolts by importing the file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/c_nutwasherbolt_516.py">https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/c_nutwasherbolt_516.py</a>.
You should be able to see the nut, washer and bolt, along with the half beam and reference point created before, as follows after importing:
</p>
<p width="600px">
<img src="./figs/nwb.png" alt="nwb.png" width="600px" />
The Python script also assigns the material "STEEL" (see above) to the parts.
</p></li>
</ol>

<p>
The file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step0.cae">model_step0.cae</a> stores the CAE file at the end of the above steps (building parts, and partitioning).
</p>
</div>
</div>
<div id="outline-container-sec:setcreat" class="outline-3">
<h3 id="sec:setcreat"><span class="section-number-3">2.3.</span> Creating appropriate surface sets&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-sec:setcreat">
<p>
It is necessary to choose appropriate surface sets for the constraint enforcement and, eventually, the interfacial mesh extraction.
Doing this with surfaces (before meshing) is advantageous since the same scripts can be reused even if the model is remeshed.
</p>
<ol class="org-ol">
<li><p>
First select the <b>interfacial faces</b> on the half beam model and assign the name <code>INSURF</code> to it.
You can do this through <code>Tools-&gt;Surface-&gt;Create</code> and then selecting the appropriate faces through the GUI.
Select the faces by holding <code>Shift</code> and deselect by holding <code>Ctrl</code>.
Here is a picture of the surface highlighted in the viewport.
</p>

<div id="orge71d9d2" class="figure">
<p><img src="./figs/insurf.png" alt="insurf.png" width="300px" />
</p>
</div></li>
<li><p>
Turn to the <i>outside</i> of the beam and select the faces around the bolts individually and name them <code>BmW1</code>, <code>BmW2</code>, and <code>BmW3</code> respectively.
These will be tied to the washer for the analysis. (<code>BmWi</code> denotes the i<sup>th</sup> Beam-Washer contact).
Here is a picture of the relevant surfaces highlighted (using different colors for each).
</p>

<div id="orgaa99d02" class="figure">
<p><img src="./figs/bmwsurfs.png" alt="bmwsurfs.png" width="300px" />
</p>
</div></li>
<li><p>
Create two surfaces on the <code>BOLT</code> model as shown in the figure below.
Name the surface marked white as <code>BlW</code> and the surface marked green as <code>BN</code>.
(<code>BlW</code> denotes the Bolt-Washer contact surface; <code>BN</code> denotes the Bolt-Nut contact surface)
</p>

<div id="org8800a70" class="figure">
<p><img src="./figs/boltsurfs.png" alt="boltsurfs.png" width="200px" />
</p>
</div></li>
<li><p>
Create two surfaces on the <code>NUT</code> model as shown in the figure below.
Name the white surface as <code>NW</code> and the green surface as <code>NB</code>.
(<code>NW</code> denotes the Nut-Washer contact surface; <code>NB</code> denotes the Nut-Bolt contact surface)
<b>Note the direction axes carefully.</b>
</p>

<div id="org727b11b" class="figure">
<p><img src="./figs/nutsurfs.png" alt="nutsurfs.png" width="200px" />
</p>
</div></li>
<li><p>
Create two surface on the <code>WASHER</code> model and label them as <code>WSTOP</code> and <code>WSBOT</code> (short for Washer-Surface Top and Bottom).
Here is a graphical depiction of the model with the surfaces.
</p>

<div id="org6a000c0" class="figure">
<p><img src="./figs/wshrsurf.png" alt="wshrsurf.png" width="200px" />
</p>
</div></li>
</ol>

<p>
Now all the parts have been created and relevant surfaces have been identified.
<b>Note</b>: It is important to have traceable but short names so that a lot of the repetitive tasks can be sped up considerably using scripting.
</p>
</div>
</div>
<div id="outline-container-orgb34b873" class="outline-3">
<h3 id="orgb34b873"><span class="section-number-3">2.4.</span> Create Assembly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-2-4">
<p>
<b>Note</b>: While importing the parts, choose Instance Type as "Independent (Mesh on Instance)".
This will be advantageous if we want to modify the meshes just at the interface for mirror symmetry.
We will do independent meshing since it is good practice, although independent meshes are not a requirement for this example (dependent meshes can be used due to symmetry).
</p>

<ol class="org-ol">
<li><p>
Import the two beams and re-orient/move them as follows.
<b>Note that the bolt-axis has to be pointed in the +z direction.</b>
This will be the convention followed throughout this tutorial.
The green beam in the following is renamed as <code>TOPBEAM</code> and the white beam in the following is renamed as <code>BOTBEAM</code>.
</p>

<div id="org75eb6b5" class="figure">
<p><img src="./figs/asb1.png" alt="asb1.png" width="400px" />
</p>
</div></li>
<li><p>
Import one instance each of the <code>BOLT</code> and <code>NUT</code> and 2 instances of the <code>WASHER</code> and assemble them as shown.
Ensure that the washer is oriented (on each side) with the <code>WSTOP</code> oriented in the <code>-z</code> direction and the <code>WSBOT</code> is oriented in the <code>+z</code> direction.
Rename the washer instances in the top and bottom as <code>TOPWASHER-1</code> and <code>BOTWASHER-1</code> respectively.
Rename the bolt and nut as <code>NUT-1</code> and <code>BOLT-1</code> respectively.
</p>

<div id="org2e42474" class="figure">
<p><img src="./figs/asbwn.png" alt="asbwn.png" width="300px" />
</p>
</div></li>
<li><p>
Import one instance of the reference point <code>REFPT</code>.
As mentioned before, this will be used to enforce bolt prestress.
This will be achieved by first placing it at the centroid of the intersection of the <code>BOLT</code> and <code>NUT</code> (surfaces <code>BN</code> and <code>NB</code>).
It is important that the reference point is placed at the centroid.
This can be done in the GUI by first moving it to an external point and then translating it along the axis.
The figure below shows an example (a datum point was used for this here).
Rename this to <code>BPT-1</code> (standing for Bolt Point 1).
</p>

<div id="orgfe2750c" class="figure">
<p><img src="./figs/asrpt.png" alt="asrpt.png" width="400px" />
</p>
</div></li>
<li>Now import another instance of the reference point <code>REFPT</code> and translate it to be coincident with <code>BPT-1</code>.
Rename this <code>NPT-1</code> (standing for Nut Point 1).
These two points will have to be on the same geometrical point but equal and opposite forces will be applied for the force application (see <a href="cref:sec:boltprel">cref:sec:boltprel</a> below for those steps).
The point <code>BPT-1</code> will be coupled to the bolt surface <code>BN</code> and <code>NPT-1</code> will be tied to the nut surface <code>NB</code> through RBE3 elements.</li>
<li><p>
Use the "Linear Pattern" dialog and copy the bolt-washer-washer-nut assembly thrice along the beam such that the assembly is complete.
The figure below shows the final assembly along with a representation of the names of the different parts.
Recall that  the beam shown in the figure below is <code>TOPBEAM</code> and the hidden one is <code>BOTBEAM</code>.
</p>

<div id="org9d0221b" class="figure">
<p><img src="./figs/as3bwn.png" alt="as3bwn.png" width="600px" />
</p>
</div></li>
</ol>

<p>
Now that the assembly is complete, the relevant constraints will have to be enforced, followed by a realization of the bolt preload.
</p>
</div>
</div>
</div>
<div id="outline-container-sec:constr" class="outline-2">
<h2 id="sec:constr"><span class="section-number-2">3.</span> Constraints</h2>
<div class="outline-text-2" id="text-sec:constr">
</div>
<div id="outline-container-orgc043826" class="outline-3">
<h3 id="orgc043826"><span class="section-number-3">3.1.</span> Tie-Constraint Enforcement&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-3-1">
<p>
All the following operations can be conducted in the <code>Interaction</code> module in CAE.
But since selecting each surface can be a time-consuming process, we use the following for-loop in ABAQUS-python (either call it as a script or just copy paste it into the CLI) to make the required tie constraints.
Specifically, it ties the Bolt-Washer, Nut-Washer, and Washer-Beam surfaces.
Note that in the last set of constraints, we recall the fact that the bottom beam is flipped.
So <code>WASHER-1</code> is tied to <code>BmW3</code> of the bottom beam (and so on for 2,3).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdb.<span style="color: #D0372D; font-style: italic;">models</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr"> 2: </span><span style="color: #BA36A5;">ras</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">rootAssembly</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr"> 5: </span>    <span style="color: #8D8D84; font-style: italic;"># Bolt-Washer Constraints</span>
<span class="linenr"> 6: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Tie</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BW-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr"> 7: </span>            <span style="color: #808080;">main</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'TOPWASHER-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'WSTOP'</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 8: </span>            <span style="color: #808080;">secondary</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOLT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BlW'</span><span style="color: #00ff00;">]</span>,
<span class="linenr"> 9: </span>            <span style="color: #808080;">positionToleranceMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">COMPUTED</span>, <span style="color: #808080;">adjust</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>,
<span class="linenr">10: </span>            <span style="color: #808080;">tieRotations</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">thickness</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #8D8D84; font-style: italic;"># Nut-Washer Constraints</span>
<span class="linenr">13: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Tie</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'NW-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr">14: </span>            <span style="color: #808080;">main</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOTWASHER-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'WSBOT'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">15: </span>            <span style="color: #808080;">secondary</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NUT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NW'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">16: </span>            <span style="color: #808080;">positionToleranceMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">COMPUTED</span>, <span style="color: #808080;">adjust</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>,
<span class="linenr">17: </span>            <span style="color: #808080;">tieRotations</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">thickness</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span>    <span style="color: #8D8D84; font-style: italic;"># TopWasher-Beam Constraints</span>
<span class="linenr">20: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Tie</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BmTW-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr">21: </span>            <span style="color: #808080;">main</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'TOPBEAM'</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BmW%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>,
<span class="linenr">22: </span>            <span style="color: #808080;">secondary</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'TOPWASHER-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'WSBOT'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">23: </span>            <span style="color: #808080;">positionToleranceMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">COMPUTED</span>, <span style="color: #808080;">adjust</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>,
<span class="linenr">24: </span>            <span style="color: #808080;">tieRotations</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">thickness</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span>    <span style="color: #8D8D84; font-style: italic;"># BotWasher-Beam Constraints</span>
<span class="linenr">27: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Tie</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BmBW-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr">28: </span>            <span style="color: #808080;">main</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOTBEAM'</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BmW%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span><span style="color: #ff00ff;">(</span><span style="color: #D0372D;">3</span><span style="color: #0000FF;">-</span>i<span style="color: #ff00ff;">)</span><span style="color: #0000FF;">%</span><span style="color: #D0372D;">3</span><span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>,
<span class="linenr">29: </span>            <span style="color: #808080;">secondary</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOTWASHER-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'WSTOP'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">30: </span>            <span style="color: #808080;">positionToleranceMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">COMPUTED</span>, <span style="color: #808080;">adjust</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>,
<span class="linenr">31: </span>            <span style="color: #808080;">tieRotations</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">thickness</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec:boltprel" class="outline-3">
<h3 id="sec:boltprel"><span class="section-number-3">3.2.</span> Bolt Preload Realization&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-sec:boltprel">
<p>
You might already have encountered the different parts of the model above that were carefully constructed for the bolt preload application (bolt-shank partitioning, reference points, etc.).
</p>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #cccccc;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         What 's wrong with the inbuilt Bolt Pretension in ABAQUS?
                      </font>
                    </strong>
                  </summary>
<p>
<b>The ABAQUS Approach</b>
</p>
<ul class="org-ul">
<li>You can find the ABAQUS documentation for the bolt load <a href="https://classes.engineering.wustl.edu/2009/spring/mase5513/abaqus/docs/v6.6/books/usi/default.htm?startat=pt04ch21s02s01.html">here</a>.</li>
<li>ABAQUS/CAE applies bolt load by specifying a <b>bolt cross-section</b>, a <b>bolt axis</b>, and the <b>bolt load</b>.</li>
<li>The documentation for the ABAQUS implementation can be found <a href="https://classes.engineering.wustl.edu/2009/spring/mase5513/abaqus/docs/v6.6/books/usb/default.htm?startat=pt07ch27s05aus102.html#usb-prc-ppretension">here</a>.</li>
<li>The load is applied in the context of a constraint:
<ul class="org-ul">
<li>It can be a load constraint wherein the displacements/strains at the cross-section are adjusted to match the load.</li>
<li>It can be a deformation constraint, wherein the loads are adjusted.</li>
</ul></li>
<li>In either case, the bolt load <b>can not be written down as a constant load vector</b> that can be exported/used elsewhere.</li>
<li>It is therefore not possible to use the inbuilt bolt pretension in a substructured analysis, for example.</li>
<li>Here are the <a href="https://classes.engineering.wustl.edu/2009/spring/mase5513/abaqus/docs/v6.6/books/usb/default.htm?startat=pt07ch27s05aus102.html#usb-prc-ppretension">documented limitations</a>:
<ul class="org-ul">
<li>An assembly load cannot be specified within a substructure.</li>
<li>If a submodeling analysis is performed, any pre-tension section should not cross regions where driven nodes are specified.</li>
<li>Nodes of a pre-tension section should not be connected to other parts of the body through multi-point constraints.</li>
</ul></li>
</ul>

<p>
<b>Our Approach</b>
</p>
<ul class="org-ul">
<li>Our method of bolt pretension application addresses all the above issues pertaining to substructuring/submodeling by using <b>Distributed Coupling</b> elements (aka RBE3/Spider elements in other FE software).</li>
<li>We will first couple the bolt-shank area that is in contact with the nut (the thread area) to a 6DOF point (3 translations + 3 rotations), and do the same for the nut inner surface, with another point, using <b>Distributed coupling</b> elements.</li>
<li>The bolt and nut will be "fastened" by arresting every DOF in these two nodes except the axial DOF. This will ensure that the only relative displacement between the bolt and nut are axial, which may result from tightening/loosening of the bolt.</li>
<li>A <b>"pulling force" is applied on the bolt-coupling node</b>, which acts as the tension on the bolt, and a <b>"pushing force" is applied on the nut-coupling node</b>, which acts to maintain the system's equilibrium, i.e., fastening.</li>
<li>It is understood that there is an interface that the assembly is tightening, which should provide the required reaction forces to balance everything out.</li>
<li>Now, the bolt load is merely a constant force vector which can be manipulated as one desires.</li>
</ul>


</details>

<p>
We will now go through the process of specifying this.
</p>
<ol class="org-ol">
<li><p>
First couple the bolt-shank surface <code>BN</code> with the appropriate reference point (<code>BPT-n</code>).
This can be done in CAE through <code>Interaction-&gt;Create Constraint-&gt;Tie</code>.
The following is python code that will do this in a loop.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">32: </span><span style="color: #8D8D84; font-style: italic;"># Bolt and Nut Point Coupling</span>
<span class="linenr">33: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">34: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Coupling</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BPC-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr">35: </span>                 <span style="color: #808080;">controlPoint</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">36: </span>                 <span style="color: #808080;">surface</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOLT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BN'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">37: </span>                 <span style="color: #808080;">influenceRadius</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">WHOLE_SURFACE</span>, <span style="color: #808080;">couplingType</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">STRUCTURAL</span>,
<span class="linenr">38: </span>                 <span style="color: #808080;">weightingMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">UNIFORM</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">39: </span>
<span class="linenr">40: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Coupling</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'NPC-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>,
<span class="linenr">41: </span>                 <span style="color: #808080;">controlPoint</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">42: </span>                 <span style="color: #808080;">surface</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NUT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NB'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">43: </span>                 <span style="color: #808080;">influenceRadius</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">WHOLE_SURFACE</span>, <span style="color: #808080;">couplingType</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">STRUCTURAL</span>,
<span class="linenr">44: </span>                 <span style="color: #808080;">weightingMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">UNIFORM</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Now we constrain the X, Y, Rx, Ry, and Rz DOFs (all 5 DOFs other than the Z DOF, which is the bolt-axis) using equation constraints.
If the bolt axis is not a principal direction in the model, then the constraint equations must be modified appropriately.
Note that this can also be used in the large deformation context through the use of a local coordinate system (the global CS is used here, so <b>applicability is restricted to small deformations</b>).
This can be done in CAE through <code>Interaction-&gt;Create Constraint-&gt;Coupling</code>.
The following code does this through a nested loop such that <b><code>BNEQn-m</code>  represents the m<sup>th</sup> DOF constraint at the n<sup>th</sup> location</b>.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">45: </span><span style="color: #8D8D84; font-style: italic;"># Equation Constraints constraining bolt and nut ref-points to each other</span>
<span class="linenr">46: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">47: </span>    <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">j</span> <span style="color: #0000FF;">in</span> <span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">2</span>, <span style="color: #D0372D;">4</span>, <span style="color: #D0372D;">5</span>, <span style="color: #D0372D;">6</span><span style="color: #00ffff; font-weight: bold;">]</span>:
<span class="linenr">48: </span>        mdl.<span style="color: #6434A3; font-style: italic;">Equation</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BNEQ%d-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i, j<span style="color: #00ff00;">)</span>,
<span class="linenr">49: </span>                     <span style="color: #808080;">terms</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1.0</span>, <span style="color: #008000;">'BPT-%d.Set-1'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, j<span style="color: #1e90ff;">)</span>,
<span class="linenr">50: </span>                            <span style="color: #1e90ff;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.0</span>,<span style="color: #008000;">'NPT-%d.Set-1'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, j<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
Here is an image showing the constraints applied graphically.
</p>

<div id="org69bd52b" class="figure">
<p><img src="./figs/conss.png" alt="conss.png" width="400px" />
</p>
</div></li>
<li><p>
We next create a static analysis step (<code>Step-&gt;Create Step-&gt;Static, General</code>) named as <code>PRESTRESS</code>.
This can be done in CAE, but here is the Python code.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">51: </span>mdl.<span style="color: #6434A3; font-style: italic;">StaticStep</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'PRESTRESS'</span>, <span style="color: #808080;">previous</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Initial'</span>, <span style="color: #808080;">nlgeom</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
<b>Note</b>: Nonlinear Geometric effects (nlgeom) is set to ON since this was found to be helpful for convergence of prestress analysis.   
</p></li>
<li><p>
We finally apply bolt forces as concentrated forces at the <code>BPT-n</code> and <code>NPT-n</code> reference points.
Switch to the <code>Load</code> module to do this from CAE.
The following python code applies a tightening load of 12kN to each bolt.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">52: </span><span style="color: #8D8D84; font-style: italic;"># Apply forces</span>
<span class="linenr">53: </span><span style="color: #BA36A5;">bpmag</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">12e3</span>  <span style="color: #8D8D84; font-style: italic;"># 12kN bolt-load</span>
<span class="linenr">54: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">55: </span>    <span style="color: #8D8D84; font-style: italic;"># Force in +z on bolt-points</span>
<span class="linenr">56: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BoltLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'PRESTRESS'</span>,
<span class="linenr">57: </span>                          <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">58: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=</span>bpmag, <span style="color: #808080;">distributionType</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">UNIFORM</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">59: </span>
<span class="linenr">60: </span>    <span style="color: #8D8D84; font-style: italic;"># Force in -z on bolt-points</span>
<span class="linenr">61: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'NutLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'PRESTRESS'</span>,
<span class="linenr">62: </span>                          <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">63: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=-</span>bpmag, <span style="color: #808080;">distributionType</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">UNIFORM</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>

<div id="org71442db" class="figure">
<p><img src="./figs/loads.png" alt="loads.png" width="400px" />
</p>
</div></li>
<li><b>Note</b> that the bolt load constructed in the above manner is a "linear" load - i.e., the load can be increased/decreased by scaling the resulting force vector.
It is assumed here that all 3 bolts are loaded equally.
If this is not the case, the different loads can be exported separately and scaled appropriately (for external analysis).
It is, however, a physical requirement for equilibrium that <code>BoltLoad-n</code> and <code>NutLoad-n</code> have to be of equal magnitude and opposite signs.</li>
</ol>

<p>
The file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1.cae">model_step1.cae</a> stores the CAE-file generated after the end of the above steps.
We will now proceed with meshing.
</p>
</div>
</div>
</div>
<div id="outline-container-sec:meshing" class="outline-2">
<h2 id="sec:meshing"><span class="section-number-2">4.</span> Meshing</h2>
<div class="outline-text-2" id="text-sec:meshing">
<p>
Since the model is perfectly symmetric, it is sufficient to mesh the model with a global seed, after seeding the interface area locally.
Switch to the <code>Mesh</code> module for this section.
</p>

<p>
If such symmetry is not available, one may choose a more direct approach by using the <code>bottom-up</code> meshing to copy the mesh from one interface to another directly.
Please <a href="mailto:nidish.balaji@ila.uni-stuttgart.de">write to me</a> if you'd like an example for this.
</p>
</div>
<div id="outline-container-org65e4079" class="outline-3">
<h3 id="org65e4079"><span class="section-number-3">4.1.</span> Meshing Instructions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li><p>
Choose <code>Mesh-&gt;Assign Mesh Controls</code> and select the whole assembly (all the instances).
We will use a structured hex-dominated element type for the full model (it will give a warning that this is not possible for certain regions. This is okay).
</p>

<div id="orgd1ee707" class="figure">
<p><img src="./figs/globmesh.png" alt="globmesh.png" width="300px" />
</p>
</div></li>
<li><p>
Now choose <code>Mesh-&gt;Seed Part Instance</code> and select all the instances again.
Set 0.00254 as the global mesh seed (to ensure 10 elements across thickness) and 0.05 for curvature control.
</p>

<div id="org5471283" class="figure">
<p><img src="./figs/gmeshseed.png" alt="gmeshseed.png" width="300px" />
</p>
</div></li>
<li><p>
Apply local seeds at the interface as shown here (on both interfaces).
Use the <code>Mesh-&gt;Seed Edges</code> tool by choosing the Method as "By Number" and specify the number of elements.
</p>

<div id="orgc1debc7" class="figure">
<p><img src="./figs/lmeshseeds.png" alt="lmeshseeds.png" width="400px" />
</p>
</div></li>
<li><p>
Now mesh the assembly using <code>Mesh-&gt;Mesh Part Instance</code> and selecting all the part instances.
Here is a view of the interfacial mesh you should get after the above seeding.
</p>

<div id="orgae863a1" class="figure">
<p><img src="./figs/mesh.png" alt="mesh.png" width="300px" />
</p>
</div></li>
<li><p>
Here is an image of the total assembly with the mesh.
</p>

<div id="orgc18c4b9" class="figure">
<p><img src="./figs/fullmesh.png" alt="fullmesh.png" width="400px" />
</p>
</div></li>
</ol>

<p>
The file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1a.cae">model_step1a.cae</a> stores the CAE-file along with the mesh.
</p>
</div>
</div>
<div id="outline-container-sec:abqprs" class="outline-3">
<h3 id="sec:abqprs"><span class="section-number-3">4.2.</span> (Optional, recommended) Verify correctness of model through frictionless prestress&#xa0;&#xa0;&#xa0;<span class="tag"><span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-sec:abqprs">
<p>
We will now conduct a simple frictionless contact analysis to verify the correctness of the model.
</p>

<p>
<b>Setup</b>
</p>
<ol class="org-ol">
<li><p>
For the static prestress analysis, first a surface-to-surface contact interaction property has to be created and assigned.
You can do this from CAE starting from <code>Interaction-&gt;Create Interaction</code> and following the steps in the figure below.
</p>

<div id="org6418bad" class="figure">
<p><img src="./figs/setcontact.png" alt="setcontact.png" width="600px" />
</p>
</div></li>
<li><p>
Now create two linear frequency steps, one before and one after the static prestress step, as shown in the figure below.
Request 30 eigenvalues in each case.
</p>

<div id="org928ed63" class="figure">
<p><img src="./figs/lfreq.png" alt="lfreq.png" width="400px" />
</p>
</div></li>
<li><p>
Create 2 jobs. Suppress the interaction property in the first one and have just <code>FREQ1</code> active (see figure below).
</p>
<p width="600px">
<img src="./figs/run1.png" alt="run1.png" width="600px" />
For the second job, suppress <code>FREQ1</code> and resume the other steps. Resume the surface interaction properties (see figure below).
</p>
<p width="600px">
<img src="./figs/run2.png" alt="run2.png" width="600px" />
Optionally, field outputs for <code>FREQ2</code> (by default it will be set to none if <code>FREQ1</code> is suppressed).
You can do this in <code>Step-&gt;Create Field Outputs</code>.
</p>

<div id="orgfb769a8" class="figure">
<p><img src="./figs/run2_fo.png" alt="run2_fo.png" width="300px" />
</p>
</div></li>
</ol>
<p>
<b>Results</b>
</p>
<ol class="org-ol">
<li><p>
The first analysis should reveal that the system has <b>7 Rigid Body Modes</b> (RBMs).
This is because the two beams are  constrained together in all directions except the axial (where tightening has to happen).
So the number of RBMs has to be \(2\times 6 - 5 = 7\).
The first 10 modal frequencies have to be (frequencies in cycles/time, or Hz):
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-right">Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1.0515e-3</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1.2851e-3</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1.4602e-3</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1.6246e-3</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">1.6592e-3</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">1.8082e-3</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1.9025e-3</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">70.323</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">151.26</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">609.25</td>
</tr>
</tbody>
</table>
<p>
In the above, modes 1-7 are RBMs and modes 8 onwards are the elastic modes.
Looking at the mode-shapes should make it clear that the two beams are free to move axially (the following is mode 1, for eg).
</p>

<div id="orgc4ace12" class="figure">
<p><img src="./figs/res1.png" alt="res1.png" width="400px" />
</p>
</div></li>
<li><p>
The second analysis should converge within a few iterations.
If not, the "Initial Increment Size" in <code>Step-&gt;PRESTRESS-&gt;Edit-&gt;Increment-&gt;Initial Increment Size</code> has to be reduced.
If it doesn't converge, try to apply a boundary condition to make the problem well-posed, and try again.
If it still doesn't converge, check your model again.
Here is a picture of the contact pressures at the interface at the end of the static prestress step.
</p>

<div id="org5abb35b" class="figure">
<p><img src="./figs/res2_1.png" alt="res2_1.png" width="400px" />
</p>
</div></li>
<li><p>
By default, ABAQUS <b>fuses the nodes</b> that are in contact at the end of the hard contact step, for the eigenvalue analysis that follows it (Linear Perturbation step).
Since we are using frictionless tangential here, the tangential DOFs are not fused.
Here are the first 10 frequencies from the <code>FREQ2</code> step (frequencies in cycles/time, or Hz):
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-right">Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.00</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">0.00</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">0.00</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">0.00</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">0.00</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">2.2068e-3</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">141.10</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">152.42</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">570.33</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">643.49</td>
</tr>
</tbody>
</table>
<p>
It must be observed that the model, under the prestressed state, <b>has only 6 RBMs</b>.
In other words, the bolt-axial direction has now been fixed due to the fact that the contact constraints are active on at least one spot on the interface.
</p></li>
<li>If your model passes all the above, then you are ready to proceed.</li>
<li><b>Note, however, that this does not imply accuracy of the model. One would have to do a mesh convergence analysis in this case.</b>
For contact problems, it is well known that the interfacial discretization must be very fine for convergence.
Much coarser meshes are, however, found to be sufficient for predicting global quantities such as natural frequency and (nonlinear) damping estimates, etc.
Such a convergence analysis is presented in the appendix of <a href="https://scholarship.rice.edu/handle/1911/113700">this thesis</a>.</li>
</ol>

<p>
The file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step2.cae">model_step2.cae</a> is the cae file containing the model with the above tests included.
</p>
</div>
</div>
</div>
<div id="outline-container-sec:meshproc" class="outline-2">
<h2 id="sec:meshproc"><span class="section-number-2">5.</span> Mesh Process</h2>
<div class="outline-text-2" id="text-sec:meshproc">
<p>
Now that the model is verified to be correct/consistent, we will proceed with the steps necessary for substructured Matrix Extraction.
</p>

<p>
Before proceeding it is necessary to first identify nodes on the meshed model that correspond to the input and output locations.
Choose the mid point on the right end as the output node for this tutorial.
Create a node set called <code>OutNodes</code> by selecting <code>Mesh-&gt;Tools-&gt;Set-&gt;Create-&gt;Node</code> and choosing the node. Select "unsorted node set" if available.
</p>
<p width="300px">
<img src="./figs/outnode.png" alt="outnode.png" width="300px" />
It is possible to choose multiple nodes here if you have a MIMO case.
</p>

<p>
It is also helpful to use global node and element indexing henceforth.
This can be specified in <code>Model-&gt;Edit Attributes-&gt;Model-1</code> as follows:
</p>

<div id="org589bfa0" class="figure">
<p><img src="./figs/modl.png" alt="modl.png" width="300px" />
</p>
</div>
</div>
<div id="outline-container-orgfc7d660" class="outline-3">
<h3 id="orgfc7d660"><span class="section-number-3">5.1.</span> Reorganize Interfacial Node Sets (readjust if necessary)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-5-1">
<p>
Although we have taken care to ensure that the mesh of the <code>TOPBEAM</code> and <code>BOTBEAM</code> are conformal at the interface, minor imperfections in the nodal locations may exist.
Furthermore, the ordering of the nodes on the top interface will be different from that on the bottom interface.
Through some scripting, we can create node sets in such a way that the top and bottom interface nodesets are ordered in a convenient fashion.
</p>

<p>
You can use the <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1a.cae">model_step1a.cae</a> and work along if you are here just for this section.
</p>

<ol class="org-ol">
<li><p>
We use the following slightly modified header for this script:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span style="color: #8D8D84; font-style: italic;"># -*- coding: utf-8 -*-</span>
<span class="linenr"> 2: </span><span style="color: #8D8D84; font-style: italic;"># 1. Preamble</span>
<span class="linenr"> 3: </span><span style="color: #0000FF;">import</span> sys
<span class="linenr"> 4: </span><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">from</span> part <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">from</span> material <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 8: </span><span style="color: #0000FF;">from</span> section <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">from</span> assembly <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">10: </span><span style="color: #0000FF;">from</span> step <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">11: </span><span style="color: #0000FF;">from</span> interaction <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">12: </span><span style="color: #0000FF;">from</span> load <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">13: </span><span style="color: #0000FF;">from</span> mesh <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">14: </span><span style="color: #0000FF;">from</span> optimization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">15: </span><span style="color: #0000FF;">from</span> job <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">16: </span><span style="color: #0000FF;">from</span> sketch <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">17: </span><span style="color: #0000FF;">from</span> visualization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">18: </span><span style="color: #0000FF;">from</span> connectorBehavior <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #0000FF;">from</span> abaqus <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">21: </span><span style="color: #0000FF;">from</span> abaqusConstants <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">22: </span><span style="color: #0000FF;">from</span> caeModules <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span> 
<span class="linenr">23: </span><span style="color: #0000FF;">import</span> regionToolset
<span class="linenr">24: </span><span style="color: #0000FF;">import</span> job
<span class="linenr">25: </span><span style="color: #0000FF;">import</span> step
<span class="linenr">26: </span><span style="color: #0000FF;">import</span> sets
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdb.<span style="color: #D0372D; font-style: italic;">models</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">29: </span><span style="color: #BA36A5;">ras</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">rootAssembly</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span>mdl.<span style="color: #006DAF; font-style: italic;">setValues</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">noPartsInputFile</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Now we identify the top and bottom surface nodes, and store the top nodes and elements into separate variables.
The node and element ordering of the top nodes will be preserved, and the nodes in the bottom will be resorted according to this in #3 below.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">32: </span><span style="color: #8D8D84; font-style: italic;"># 2. Get top and bottom surfaces and nodes</span>
<span class="linenr">33: </span><span style="color: #BA36A5;">topsurf</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'TOPBEAM'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'INSURF'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">34: </span><span style="color: #BA36A5;">botsurf</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'BOTBEAM'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'INSURF'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">35: </span>
<span class="linenr">36: </span><span style="color: #BA36A5;">topnodes</span> <span style="color: #0000FF;">=</span> topsurf.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">37: </span><span style="color: #BA36A5;">botnodes</span> <span style="color: #0000FF;">=</span> botsurf.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">38: </span><span style="color: #BA36A5;">N</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>topnodes<span style="color: #00ffff; font-weight: bold;">)</span>  <span style="color: #8D8D84; font-style: italic;"># Number of nodes</span>
<span class="linenr">39: </span>
<span class="linenr">40: </span><span style="color: #8D8D84; font-style: italic;"># Top Nodes and Coordinates</span>
<span class="linenr">41: </span><span style="color: #BA36A5;">Topnd_dict</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">dict</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">zip</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>topnodes<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">42: </span>                       <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff00ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">]</span>, <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">43: </span><span style="color: #8D8D84; font-style: italic;"># maps original node ID (in FE model) to</span>
<span class="linenr">44: </span><span style="color: #8D8D84; font-style: italic;"># node ID in interface node set</span>
<span class="linenr">45: </span><span style="color: #BA36A5;">TopNdCds</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>topnodes<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span>
<span class="linenr">46: </span>                     <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">47: </span>
<span class="linenr">48: </span><span style="color: #8D8D84; font-style: italic;"># Top Elements</span>
<span class="linenr">49: </span><span style="color: #BA36A5;">TopEls</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">connectivity</span>
<span class="linenr">50: </span>                   <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #006FE0;">len</span><span style="color: #ff00ff;">(</span>topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">51: </span><span style="color: #BA36A5;">ELS</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">zeros</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">(</span><span style="color: #6434A3;">TopEls</span>.<span style="color: #D0372D; font-style: italic;">shape</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #1e90ff;">]</span>, <span style="color: #D0372D;">5</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">dtype</span><span style="color: #0000FF;">=</span>int<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">52: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">ne</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #6434A3;">TopEls</span>.<span style="color: #D0372D; font-style: italic;">shape</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">0</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">53: </span>    <span style="color: #BA36A5;">elefac</span> <span style="color: #0000FF;">=</span> topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #00ffff; font-weight: bold;">[</span>ne<span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #006DAF; font-style: italic;">getElemFaces</span><span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span>    <span style="color: #8D8D84; font-style: italic;"># Gives you the list of faces on the interface</span>
<span class="linenr">56: </span>    <span style="color: #8D8D84; font-style: italic;"># (we only expect a single face here)</span>
<span class="linenr">57: </span>    <span style="color: #BA36A5;">fe</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">argwhere</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span><span style="color: #006FE0;">all</span><span style="color: #1e90ff;">(</span><span style="color: #ff00ff;">[</span><span style="color: #6434A3;">Topnd_dict</span>.<span style="color: #006DAF; font-style: italic;">has_key</span><span style="color: #ff8c00;">(</span>x<span style="color: #ff8c00;">)</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">x</span> <span style="color: #0000FF;">in</span> 
<span class="linenr">58: </span>                           <span style="color: #ff8c00;">[</span>elefac<span style="color: #00ffff;">[</span>k<span style="color: #00ffff;">]</span>.<span style="color: #006DAF; font-style: italic;">getNodes</span><span style="color: #00ffff;">()[</span>i<span style="color: #00ffff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">59: </span>                            <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff;">(</span><span style="color: #D0372D;">4</span><span style="color: #00ffff;">)</span><span style="color: #ff8c00;">]</span><span style="color: #ff00ff;">]</span><span style="color: #1e90ff;">)</span>
<span class="linenr">60: </span>                      <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">k</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">6</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)[</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">61: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, <span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">=</span> ne
<span class="linenr">62: </span>    <span style="color: #8D8D84; font-style: italic;"># Searches for the face where all the nodes are in the interface</span>
<span class="linenr">63: </span>    <span style="color: #8D8D84; font-style: italic;"># and returns those nodes</span>
<span class="linenr">64: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, <span style="color: #D0372D;">1</span>:<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #6434A3;">Topnd_dict</span><span style="color: #00ff00;">[</span>x<span style="color: #00ff00;">]</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">x</span> <span style="color: #0000FF;">in</span>
<span class="linenr">65: </span>                   <span style="color: #00ff00;">[</span>elefac<span style="color: #1e90ff;">[</span>fe<span style="color: #1e90ff;">]</span>.<span style="color: #006DAF; font-style: italic;">getNodes</span><span style="color: #1e90ff;">()[</span>k<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">66: </span>                    <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">k</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">67: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, :<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">+=</span> <span style="color: #D0372D;">1</span>
<span class="linenr">68: </span>
<span class="linenr">69: </span><span style="color: #8D8D84; font-style: italic;"># Save interfacial nodes and elements to txt files</span>
<span class="linenr">70: </span>np.<span style="color: #006DAF; font-style: italic;">savetxt</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Nodes.dat'</span>, <span style="color: #6434A3;">TopNdCds</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #8D8D84; font-style: italic;"># Save to dat file</span>
<span class="linenr">71: </span>np.<span style="color: #006DAF; font-style: italic;">savetxt</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Elements.dat'</span>, <span style="color: #D0372D;">ELS</span>, <span style="color: #808080;">fmt</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'%d'</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Now we extract the bottom nodes and sort them.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">72: </span><span style="color: #8D8D84; font-style: italic;"># 3. Node Pairing. We assume len(botnodes)=len(topnodes).</span>
<span class="linenr">73: </span><span style="color: #BA36A5;">botleft</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">74: </span><span style="color: #BA36A5;">bts</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[]</span>
<span class="linenr">75: </span><span style="color: #BA36A5;">tmi</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
<span class="linenr">76: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">77: </span>    <span style="color: #8D8D84; font-style: italic;"># Calculates deviation of selected node coordinate on bottom to each</span>
<span class="linenr">78: </span>    <span style="color: #8D8D84; font-style: italic;"># node coordinate on top and "assigns" the closest one to the index.</span>
<span class="linenr">79: </span>    <span style="color: #BA36A5;">devns</span> <span style="color: #0000FF;">=</span> topnodes<span style="color: #00ffff; font-weight: bold;">[</span>i<span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span> <span style="color: #0000FF;">-</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>botnodes<span style="color: #1e90ff;">[</span>j<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span>
<span class="linenr">80: </span>                                                <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">j</span> <span style="color: #0000FF;">in</span> botleft<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">81: </span>    bts.<span style="color: #006DAF; font-style: italic;">append</span><span style="color: #00ffff; font-weight: bold;">(</span>
<span class="linenr">82: </span>        botleft.<span style="color: #006DAF; font-style: italic;">pop</span><span style="color: #00ff00;">(</span>
<span class="linenr">83: </span>            np.<span style="color: #006DAF; font-style: italic;">argmin</span><span style="color: #1e90ff;">(</span>
<span class="linenr">84: </span>                np.<span style="color: #D0372D; font-style: italic;">linalg</span>.<span style="color: #006DAF; font-style: italic;">norm</span><span style="color: #ff00ff;">(</span>
<span class="linenr">85: </span>                    devns, <span style="color: #808080;">axis</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1</span><span style="color: #ff00ff;">)</span>
<span class="linenr">86: </span>            <span style="color: #1e90ff;">)</span>
<span class="linenr">87: </span>        <span style="color: #00ff00;">)</span>
<span class="linenr">88: </span>    <span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
We now adjust the nodes on the bottom (this affects the FE mesh directly!)
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">89: </span><span style="color: #8D8D84; font-style: italic;"># 4. Adjust Nodes on Bottom Beam Interface to Match Top Beam Exactly</span>
<span class="linenr">90: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">91: </span>    ras.<span style="color: #006DAF; font-style: italic;">editNode</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">nodes</span><span style="color: #0000FF;">=</span>botnodes<span style="color: #00ff00;">[</span>bts<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>:bts<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span><span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span>,
<span class="linenr">92: </span>                 <span style="color: #808080;">coordinates</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span>topnodes<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span>,<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
We now create nodesets for the top (<code>TOPS_NDS</code>) and bottom (<code>BOTS_NDS</code>).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 93: </span><span style="color: #8D8D84; font-style: italic;"># 5. Create Node Sets</span>
<span class="linenr"> 94: </span><span style="color: #BA36A5;">botpairednds</span> <span style="color: #0000FF;">=</span> botnodes.<span style="color: #006DAF; font-style: italic;">sequenceFromLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>botnodes<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr"> 95: </span>                                                  <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> bts<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr"> 96: </span><span style="color: #8D8D84; font-style: italic;"># Reordering from the sorting above</span>
<span class="linenr"> 97: </span>
<span class="linenr"> 98: </span>ras.<span style="color: #6434A3; font-style: italic;">SetFromNodeLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"TOPS_NDS"</span>, 
<span class="linenr"> 99: </span>                      <span style="color: #808080;">nodeLabels</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>topnodes<span style="color: #ff00ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">instanceName</span>, 
<span class="linenr">100: </span>                                   <span style="color: #006FE0;">tuple</span><span style="color: #ff00ff;">(</span><span style="color: #ff8c00;">[</span>topnodes<span style="color: #00ffff;">[</span>i<span style="color: #00ffff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">101: </span>                                          <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff;">)</span><span style="color: #ff8c00;">]</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">102: </span>                      <span style="color: #808080;">unsorted</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">103: </span>ras.<span style="color: #6434A3; font-style: italic;">SetFromNodeLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"BOTS_NDS"</span>, 
<span class="linenr">104: </span>                      <span style="color: #808080;">nodeLabels</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>botpairednds<span style="color: #ff00ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">instanceName</span>, 
<span class="linenr">105: </span>                                   <span style="color: #ff00ff;">[</span>botpairednds<span style="color: #ff8c00;">[</span>i<span style="color: #ff8c00;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">106: </span>                                    <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff8c00;">(</span><span style="color: #006FE0;">len</span><span style="color: #00ffff;">(</span>botpairednds<span style="color: #00ffff;">)</span><span style="color: #ff8c00;">)</span><span style="color: #ff00ff;">]</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">107: </span>                      <span style="color: #808080;">unsorted</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
Note that we've used the unsorted keyword to ensure that ABAQUS does not reorder the nodesets (default behavior).
</p></li>
<li><p>
We now simplify the model by removing all interaction properties and steps (except initial).
One side-effect of doing this is that this removes the bolt loads also, since loads can only be saved when there is a corresponding step!
So we will reintroduce the bolt loads in the substructuring step in #8 below.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">108: </span><span style="color: #8D8D84; font-style: italic;"># 6. Simplify model (remove interactions, all steps, etc.)</span>
<span class="linenr">109: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">interactions</span>
<span class="linenr">110: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">0</span>:
<span class="linenr">111: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">112: </span>
<span class="linenr">113: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">interactionProperties</span>
<span class="linenr">114: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">0</span>:
<span class="linenr">115: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">116: </span>
<span class="linenr">117: </span><span style="color: #8D8D84; font-style: italic;"># Remove all steps except initial</span>
<span class="linenr">118: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">steps</span>
<span class="linenr">119: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">1</span>:
<span class="linenr">120: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org14446d3" class="outline-3">
<h3 id="org14446d3"><span class="section-number-3">5.2.</span> Setup Fixed interface CMS (HCB-CMS) with linear frequency and substructure steps&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-5-2">
<ol class="org-ol">
<li><p>
We are interested in <b>Fixed-Interface Component Mode Synthesis</b> with 20 retained modes.
So we first do a fixed interface modal analysis and request \(20\times3 = 60\) modes (for ensuring accuracy of the first 20 modes).
We fix all the nodes in the nodesets <code>TOPS_NDS</code> and <code>BOTS_NDS</code>.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">121: </span><span style="color: #8D8D84; font-style: italic;"># 7. Create a Frequency Step for fixed interface modal analysis</span>
<span class="linenr">122: </span>mdl.<span style="color: #6434A3; font-style: italic;">FrequencyStep</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>, <span style="color: #808080;">previous</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Initial"</span>,
<span class="linenr">123: </span>                  <span style="color: #808080;">normalization</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MASS</span>, <span style="color: #808080;">eigensolver</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">LANCZOS</span>,
<span class="linenr">124: </span>                  <span style="color: #808080;">numEigen</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">60</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">125: </span>mdl.<span style="color: #6434A3; font-style: italic;">EncastreBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"TOPFIX"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>,
<span class="linenr">126: </span>               <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'TOPS_NDS'</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">127: </span>mdl.<span style="color: #6434A3; font-style: italic;">EncastreBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"BOTFIX"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>,
<span class="linenr">128: </span>               <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOTS_NDS'</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Next, we create the substructuring step and re-specify the bolt loads (these were removed in #6 above).
The bolt loads are specified of unit magnitude and can be scaled during analysis.
<b>This by default uses the mode shapes from the previous step and calculates static constraint modes automatically.</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">129: </span><span style="color: #8D8D84; font-style: italic;"># 8. Create a substructuring step, specify the modes and retained DOFs</span>
<span class="linenr">130: </span>mdl.<span style="color: #6434A3; font-style: italic;">SubstructureGenerateStep</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>, <span style="color: #808080;">previous</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>,
<span class="linenr">131: </span>                             <span style="color: #808080;">substructureIdentifier</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1</span>, 
<span class="linenr">132: </span>                             <span style="color: #808080;">retainedEigenmodesMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MODE_RANGE</span>,
<span class="linenr">133: </span>                             <span style="color: #808080;">modeRange</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">20</span>, <span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">134: </span>                             <span style="color: #808080;">recoveryMatrix</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">REGION</span>,
<span class="linenr">135: </span>                             <span style="color: #808080;">recoveryRegion</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'OutNodes'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">136: </span>                             <span style="color: #808080;">computeReducedMassMatrix</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">137: </span>
<span class="linenr">138: </span><span style="color: #8D8D84; font-style: italic;"># The name dictates ordering. A comes before B.</span>
<span class="linenr">139: </span>mdl.<span style="color: #6434A3; font-style: italic;">RetainedNodalDofsBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"A"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>, 
<span class="linenr">140: </span>                        <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'TOPS_NDS'</span><span style="color: #00ff00;">]</span>, 
<span class="linenr">141: </span>                        <span style="color: #808080;">u1</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u2</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u3</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">142: </span>mdl.<span style="color: #6434A3; font-style: italic;">RetainedNodalDofsBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"B"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>, 
<span class="linenr">143: </span>                        <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BOTS_NDS'</span><span style="color: #00ff00;">]</span>, 
<span class="linenr">144: </span>                        <span style="color: #808080;">u1</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u2</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u3</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">145: </span>
<span class="linenr">146: </span><span style="color: #8D8D84; font-style: italic;"># Apply Bolt Loads (1N magnitude)</span>
<span class="linenr">147: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">148: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BoltLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>,
<span class="linenr">149: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1.0</span>,
<span class="linenr">150: </span>                          <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">151: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'NutLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>,
<span class="linenr">152: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=-</span><span style="color: #D0372D;">1.0</span>,
<span class="linenr">153: </span>                          <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'Set-1'</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">154: </span>
<span class="linenr">155: </span><span style="color: #BA36A5;">sbs</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">steps</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'HCBCMS'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">156: </span>sbs.<span style="color: #6434A3; font-style: italic;">LoadCase</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"LCASE"</span>,
<span class="linenr">157: </span>             <span style="color: #808080;">loads</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #008000;">'BoltLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, <span style="color: #D0372D;">1.0</span><span style="color: #1e90ff;">)</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span> <span style="color: #0000FF;">+</span>
<span class="linenr">158: </span>             <span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #008000;">'NutLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, <span style="color: #D0372D;">1.0</span><span style="color: #1e90ff;">)</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
Note, in the above that the ordering of the two sets is controlled by the name given to the <code>RetainedNodalDofsBC</code> function.
Although the node sets themselves are not sorted, the order in which the nodesets appear is sorted by default.
</p></li>
<li><p>
We finally need to request matrix output.
<a href="https://classes.engineering.wustl.edu/2009/spring/mase5513/abaqus/docs/v6.6/books/key/default.htm?startat=ch18abk43.html">Here</a> is the ABAQUS documentation for the <code>*Substructure Matrix Output</code> card.
Thus far (until version 2023) ABAQUS CAE doesn't support requesting matrix output from Substructure steps.
We have to request this manually in the .inp files.
Thankfully we can write to the keywords directly from CAE.
Go to <code>Model-&gt;Edit Keywords-&gt;Model-1</code> to do this in the GUI.
In scripting, this is known as a "synch" operation, which is done as follows:
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">159: </span><span style="color: #8D8D84; font-style: italic;"># 9. Request substructure matrix outputs</span>
<span class="linenr">160: </span><span style="color: #8D8D84; font-style: italic;"># ABAQUS CAE doesn't support this yet (GUI or scripting),</span>
<span class="linenr">161: </span><span style="color: #8D8D84; font-style: italic;"># so the keywords need to be manually modified.</span>
<span class="linenr">162: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">synchVersions</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">storeNodesAndElements</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">False</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">163: </span>
<span class="linenr">164: </span><span style="color: #BA36A5;">li</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">argwhere</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">][</span><span style="color: #D0372D;">0</span>:<span style="color: #D0372D;">20</span><span style="color: #1e90ff;">]</span> <span style="color: #0000FF;">==</span> <span style="color: #008000;">"*Retained Nodal Dofs"</span>
<span class="linenr">165: </span>                  <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #006FE0;">len</span><span style="color: #ff00ff;">(</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)[</span><span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">][</span><span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">166: </span><span style="color: #BA36A5;">txi</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #00ffff; font-weight: bold;">[</span>li<span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">167: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">replace</span><span style="color: #00ffff; font-weight: bold;">(</span>li, <span style="color: #008000;">"*Retained Nodal Dofs, sorted=NO"</span><span style="color: #0000FF;">+</span>txi<span style="color: #00ff00;">[</span><span style="color: #D0372D;">20</span>:<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">168: </span>
<span class="linenr">169: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">insert</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">len</span><span style="color: #00ff00;">(</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #00ff00;">)</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">2</span>, 
<span class="linenr">170: </span>                        <span style="color: #008000;">"*Substructure Matrix Output, FILE NAME=Modelmats, "</span> <span style="color: #0000FF;">+</span>
<span class="linenr">171: </span>                        <span style="color: #008000;">"MASS=YES, STIFFNESS=YES, SLOAD=YES, "</span> <span style="color: #0000FF;">+</span>
<span class="linenr">172: </span>                        <span style="color: #008000;">"RECOVERY MATRIX=YES"</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
We then create a job and write it to an "inp" file that can be run from ABAQUS.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">173: </span><span style="color: #8D8D84; font-style: italic;"># 10. Create a job and write an inp file</span>
<span class="linenr">174: </span>mdb.<span style="color: #6434A3; font-style: italic;">Job</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Job"</span>, <span style="color: #808080;">model</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">175: </span>mdb.<span style="color: #D0372D; font-style: italic;">jobs</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Job'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #006DAF; font-style: italic;">writeInput</span><span style="color: #00ffff; font-weight: bold;">()</span>
</pre>
</div></li>
<li><p>
Here is what the final HCBCMS step looks like in this case.
The most important part is the <code>*Substructure Matrix Output</code> card in the bottom,
which we introduced through the "synch" step in #3 above.
<a href="https://classes.engineering.wustl.edu/2009/spring/mase5513/abaqus/docs/v6.6/books/key/default.htm?startat=ch18abk43.html">Here</a> is the ABAQUS documentation for the <code>*Substructure Matrix Output</code> card.
</p>
<div class="org-src-container">
<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* ----------------------------------------------------------------</span>
<span class="linenr"> 2: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* </span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* STEP: HCBCMS</span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Step, name=HCBCMS, nlgeom=NO</span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Substructure Generate, overwrite, type=Z1, recovery matrix=YES,</span>
<span class="linenr"> 7: </span>    <span style="color: #c05fc05fc05f;"> </span> nset=OutNodes, mass matrix=YES
<span class="linenr"> 8: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Select Eigenmodes, generate</span>
<span class="linenr"> 9: </span><span style="color: #D0372D;">1</span>, 20, 1
<span class="linenr">10: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Damping Controls, structural=COMBINED, viscous=COMBINED</span>
<span class="linenr">11: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Retained Nodal Dofs, sorted=NO</span>
<span class="linenr">12: </span>BOTS_NDS, 1, 3
<span class="linenr">13: </span>TOPS_NDS, 1, 3
<span class="linenr">14: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* </span>
<span class="linenr">15: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* LOAD CASES</span>
<span class="linenr">16: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* </span>
<span class="linenr">17: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Substructure Load Case, name=LCASE</span>
<span class="linenr">18: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: BoltLoad-1   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">19: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">20: </span>BPT-1_Set-1, 3, 1.
<span class="linenr">21: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: BoltLoad-2   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">22: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">23: </span>BPT-2_Set-1, 3, 1.
<span class="linenr">24: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: BoltLoad-3   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">25: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">26: </span>BPT-3_Set-1, 3, 1.
<span class="linenr">27: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: NutLoad-1   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">28: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">29: </span>NPT-1_Set-1, 3, -1.
<span class="linenr">30: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: NutLoad-2   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">31: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">32: </span>NPT-2_Set-1, 3, -1.
<span class="linenr">33: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* Name: NutLoad-3   Type: Concentrated force   Scale factor: 1</span>
<span class="linenr">34: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Cload</span>
<span class="linenr">35: </span>NPT-3_Set-1, 3, -1.
<span class="linenr">36: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">Substructure Matrix Output, FILE NAME=Modelmats, MASS=YES,</span>
<span class="linenr">37: </span>    <span style="color: #c05fc05fc05f;"> </span> STIFFNESS=YES, SLOAD=YES, RECOVERY MATRIX=YES
<span class="linenr">38: </span><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">End Step</span>
</pre>
</div>
<p>
You can find the inp-file generate from the above in <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/demo/Job.inp">Job.inp</a>.
</p></li>
</ol>
</div>
</div>
<div id="outline-container-org11b2ac2" class="outline-3">
<h3 id="org11b2ac2"><span class="section-number-3">5.3.</span> Run Job and Generate the mtx file.&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span>&#xa0;<span class="GUI">GUI</span></span></h3>
<div class="outline-text-3" id="text-5-3">
<p>
You can now run the Job named "Job" in the GUI, or directly run the "<a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/demo/Job.inp">Job.inp</a>" file from the command line using
</p>
<div class="org-src-container">
<pre class="src src-bash">abaqus <span style="color: #BA36A5;">job</span>=Job <span style="color: #BA36A5;">inp</span>=Job.inp <span style="color: #BA36A5;">cpus</span>=2 interactive
</pre>
</div>
<p>
Once the job is done, it will output the matrix file "Modelmats.mtx" into the working directory.
This, along with the "Nodes.dat" and "Elements.dat" files that were written out earlier, are all we need for external analyses.
</p>
</div>
</div>
</div>
<div id="outline-container-sec:mex" class="outline-2">
<h2 id="sec:mex"><span class="section-number-2">6.</span> Matrix Extraction + NL-Analysis</h2>
<div class="outline-text-2" id="text-sec:mex">
<p>
By default, ABAQUS uses the <a href="https://math.nist.gov/MatrixMarket/">matrix market format</a> for the outputted matrices.
Note the following, in terms of format:
</p>
<ul class="org-ul">
<li>Each line that starts with an asterix ("*") is a comment.</li>
<li>The linear matrices of the current model are fully symmetric.</li>
<li>So only the upper triangular parts of the matrices are exported.</li>
<li>The load vector is exported as a vector.</li>
<li>Columns of the recovery matrix \(R\), defined by
\[ x_{out} = R x_{cms} \]
where \(x_{cms}\) is the vector of DOFs of the CMS model (substructure) and \(x_{out}\) are the output DOFs.
Each column of \(R\) is \(N_{out}\times 1\), and \(R\) is \(N_{out}\times N_{cms}\).</li>
</ul>
</div>
<div id="outline-container-sec:bscr" class="outline-3">
<h3 id="sec:bscr"><span class="section-number-3">6.1.</span> Postprocessing Exported Matrices&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-sec:bscr">
<ol class="org-ol">
<li>The first few lines provide the generalized coordinates of the model. The nodes are listed as positive integers and the "modal" DOFs are listed as negative integers.
This is followed by a list of DOFs active in each set.</li>
<li><p>
The STIFFNESS and MASS matrices are respectively prepended by
</p>
<div class="org-src-container">
<pre class="src src-fortran"><span style="color: #8D8D84;">*     </span><span style="color: #8D8D84; font-style: italic;">MATRIX,TYPE=STIFFNESS</span>
    <span style="color: #c05fc05fc05f;"> </span> &lt;Stiffness matrix entries in upper triangular form&gt;
     
<span style="color: #8D8D84;">*     </span><span style="color: #8D8D84; font-style: italic;">MATRIX,TYPE=MASS</span>
    <span style="color: #c05fc05fc05f;"> </span> &lt;Mass matrix entries in upper triangular form&gt;      
</pre>
</div></li>
<li><p>
The load vector (the bolt prestress load, here) is written as,
</p>
<div class="org-src-container">
<pre class="src src-fortran"><span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* SUBSTRUCTURE LOAD CASE VECTOR. SLOAD CASE &lt;name&gt;</span>
<span style="color: #8D8D84;">***</span><span style="color: #8D8D84; font-style: italic;">CLOAD </span>
<span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* 1, 1, &lt;entry&gt;</span>
<span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* 1, 2, &lt;entry&gt;</span>
<span style="color: #8D8D84;">*</span><span style="color: #8D8D84; font-style: italic;">* 1, 3, &lt;entry&gt;</span>
    <span style="color: #c05fc05fc05f;"> </span> .
    <span style="color: #c05fc05fc05f;"> </span> .
    <span style="color: #c05fc05fc05f;"> </span> .
</pre>
</div></li>
<li><p>
Finally, the recovery matrix is provided row-by-row as
</p>
<div class="org-src-container">
<pre class="src src-fortran"><span style="color: #8D8D84;">*     </span><span style="color: #8D8D84; font-style: italic;">SUBSTRUCTURE RECOVERY VECTOR CORRESPONDING TO RETAINED DOFS NUMBER 1</span>
    <span style="color: #c05fc05fc05f;"> </span> &lt;entries&gt;
<span style="color: #8D8D84;">*     </span><span style="color: #8D8D84; font-style: italic;">SUBSTRUCTURE RECOVERY VECTOR CORRESPONDING TO RETAINED DOFS NUMBER 2</span>
    <span style="color: #c05fc05fc05f;"> </span> &lt;entries&gt;
    <span style="color: #c05fc05fc05f;"> </span> .
    <span style="color: #c05fc05fc05f;"> </span> .
    <span style="color: #c05fc05fc05f;"> </span> .
</pre>
</div></li>
<li>In the actual file, the order is STIFFNESS, LOAD, MASS, then SUBSTRUCTURE.</li>
<li><p>
The following Bash script processes the output (a stiffness, a mass, a load case, and recovery entries are expected)
</p>
<div class="org-src-container">
<pre class="src src-bash"><span class="linenr">  1: </span><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/bin/</span><span style="color: #0000FF;">sh</span>
<span class="linenr">  2: </span>
<span class="linenr">  3: </span><span style="color: #0000FF;">if</span> <span style="color: #00ffff; font-weight: bold;">[</span> $<span style="color: #BA36A5;">#</span> = 2 <span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">  4: </span><span style="color: #0000FF;">then</span> 
<span class="linenr">  5: </span>    <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"Correct call!"</span>
<span class="linenr">  6: </span>    <span style="color: #BA36A5;">OUT</span>=$<span style="color: #BA36A5;">2</span>
<span class="linenr">  7: </span><span style="color: #0000FF;">elif</span> <span style="color: #00ffff; font-weight: bold;">[</span> $<span style="color: #BA36A5;">#</span> = 1 <span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">  8: </span><span style="color: #0000FF;">then</span>
<span class="linenr">  9: </span>    <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"Acceptable call!"</span>
<span class="linenr"> 10: </span>    <span style="color: #BA36A5;">a</span>=<span style="color: #008000;">"$1"</span>
<span class="linenr"> 11: </span>    <span style="color: #BA36A5;">OUT</span>=<span style="color: #008000;">"${a%.*}.mat"</span>
<span class="linenr"> 12: </span><span style="color: #0000FF;">else</span>
<span class="linenr"> 13: </span>    <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"Wrong call - quitting!"</span>
<span class="linenr"> 14: </span><span style="color: #0000FF;">fi</span>
<span class="linenr"> 15: </span><span style="color: #006FE0;">echo</span> <span style="color: #008000;">"Preprocessing mtx files"</span>
<span class="linenr"> 16: </span><span style="color: #BA36A5;">awkcmd1</span>=<span style="color: #008000;">'BEGIN{mstart=0;}</span>
<span class="linenr"> 17: </span><span style="color: #008000;">  ($1~/^\*M/){mstart++; next}</span>
<span class="linenr"> 18: </span><span style="color: #008000;">  (mstart==1){if($1!~/^\*/){print}else{exit}}'</span>
<span class="linenr"> 19: </span><span style="color: #BA36A5;">awkcmd2</span>=<span style="color: #008000;">'BEGIN{RS=",";ORS="\n"}{print}'</span>
<span class="linenr"> 20: </span>gawk <span style="color: #008000;">"$awkcmd1"</span> $<span style="color: #BA36A5;">1</span>|gawk <span style="color: #008000;">"$awkcmd2"</span>|gawk <span style="color: #008000;">'(NF!=0){print}'</span> &gt; ./.STIFFNESS.mtx
<span class="linenr"> 21: </span>
<span class="linenr"> 22: </span><span style="color: #BA36A5;">awkcmd1</span>=<span style="color: #008000;">'BEGIN{mstart=0;}</span>
<span class="linenr"> 23: </span><span style="color: #008000;">  ($1~/^\*M/){mstart++; next}</span>
<span class="linenr"> 24: </span><span style="color: #008000;">  (mstart==2){if($1!~/^\*/){print}else{exit}}'</span>
<span class="linenr"> 25: </span><span style="color: #BA36A5;">awkcmd2</span>=<span style="color: #008000;">'BEGIN{RS=",";ORS="\n"}{print}'</span>
<span class="linenr"> 26: </span>gawk <span style="color: #008000;">"$awkcmd1"</span> $<span style="color: #BA36A5;">1</span>|gawk <span style="color: #008000;">"$awkcmd2"</span>|gawk <span style="color: #008000;">'(NF!=0){print}'</span> &gt; ./.MASS.mtx
<span class="linenr"> 27: </span>
<span class="linenr"> 28: </span><span style="color: #BA36A5;">awkcmd1</span>=<span style="color: #008000;">'BEGIN{vstart=0;}</span>
<span class="linenr"> 29: </span><span style="color: #008000;">  ($0~/^\*\*\*C/){vstart++; next}</span>
<span class="linenr"> 30: </span><span style="color: #008000;">  (vstart&gt;0){print $2,$3,$4}</span>
<span class="linenr"> 31: </span><span style="color: #008000;">  (vstart&gt;0 &amp;&amp; $1!~/^\*\*/){exit}'</span>
<span class="linenr"> 32: </span><span style="color: #BA36A5;">awkcmd2</span>=<span style="color: #008000;">'BEGIN{FS=","}</span>
<span class="linenr"> 33: </span><span style="color: #008000;">  {for(i=1;i&lt;=NF;i++)</span>
<span class="linenr"> 34: </span><span style="color: #008000;">    printf("%s ", $i);</span>
<span class="linenr"> 35: </span><span style="color: #008000;">    printf("\n")}'</span>
<span class="linenr"> 36: </span>gawk <span style="color: #008000;">"$awkcmd1"</span> $<span style="color: #BA36A5;">1</span>|gawk <span style="color: #008000;">"$awkcmd2"</span> &gt; ./.FVEC.mtx
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span><span style="color: #BA36A5;">awkcmd1</span>=<span style="color: #008000;">'BEGIN{rstart=0}</span>
<span class="linenr"> 39: </span><span style="color: #008000;"> ($0~/^\*\* SUBSTRUCTURE REC/){rstart++;</span>
<span class="linenr"> 40: </span><span style="color: #008000;"> if(rstart&gt;1){printf("\n")}</span>
<span class="linenr"> 41: </span><span style="color: #008000;"> next}</span>
<span class="linenr"> 42: </span><span style="color: #008000;"> (rstart!=0 &amp;&amp; $1~/\*\*/){</span>
<span class="linenr"> 43: </span><span style="color: #008000;"> for(i=2;i&lt;=NF;i++)printf("%s",$i);}'</span>
<span class="linenr"> 44: </span><span style="color: #BA36A5;">awkcmd2</span>=<span style="color: #008000;">'BEGIN{FS=","}</span>
<span class="linenr"> 45: </span><span style="color: #008000;">  {for(i=1;i&lt;=NF;i++)</span>
<span class="linenr"> 46: </span><span style="color: #008000;">    printf("%s ",$i);</span>
<span class="linenr"> 47: </span><span style="color: #008000;">    printf("\n");}'</span>
<span class="linenr"> 48: </span>gawk <span style="color: #008000;">"$awkcmd1"</span> $<span style="color: #BA36A5;">1</span>|gawk <span style="color: #008000;">"$awkcmd2"</span> &gt; .RECOV.mtx
<span class="linenr"> 49: </span>
<span class="linenr"> 50: </span><span style="color: #006FE0;">echo</span> <span style="color: #008000;">"Preprocessing mtx files done"</span>
<span class="linenr"> 51: </span>
<span class="linenr"> 52: </span>python &lt;&lt;EOF
<span class="linenr"> 53: </span><span style="color: #0000ff; background-color: #EEF5FE;">import numpy as np</span>
<span class="linenr"> 54: </span><span style="color: #0000ff; background-color: #EEF5FE;">import scipy.io as io</span>
<span class="linenr"> 55: </span>
<span class="linenr"> 56: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Reading Mass Matrix from mtx file.");</span>
<span class="linenr"> 57: </span><span style="color: #0000ff; background-color: #EEF5FE;">Mv = np.loadtxt('.MASS.mtx');</span>
<span class="linenr"> 58: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.");</span>
<span class="linenr"> 59: </span>
<span class="linenr"> 60: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Reading Stiffness Matrix from mtx file.");</span>
<span class="linenr"> 61: </span><span style="color: #0000ff; background-color: #EEF5FE;">Kv = np.loadtxt('.STIFFNESS.mtx');</span>
<span class="linenr"> 62: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.");</span>
<span class="linenr"> 63: </span>
<span class="linenr"> 64: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Reading Recovery Matrix from mtx file.");</span>
<span class="linenr"> 65: </span><span style="color: #0000ff; background-color: #EEF5FE;">R = np.loadtxt('.RECOV.mtx');</span>
<span class="linenr"> 66: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.");</span>
<span class="linenr"> 67: </span>
<span class="linenr"> 68: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Processing Matrices.")</span>
<span class="linenr"> 69: </span>
<span class="linenr"> 70: </span><span style="color: #0000ff; background-color: #EEF5FE;">Nelm = len(Mv);</span>
<span class="linenr"> 71: </span><span style="color: #0000ff; background-color: #EEF5FE;">Nelk = len(Kv);</span>
<span class="linenr"> 72: </span><span style="color: #0000ff; background-color: #EEF5FE;">if (Nelm!=Nelk):</span>
<span class="linenr"> 73: </span><span style="color: #0000ff; background-color: #EEF5FE;">    </span><span style="color: #c05fc05fc05f;"> </span><span style="color: #0000ff; background-color: #EEF5FE;">   sys.exit("GIGO - Mass &amp; Stiffness not of same length.");</span>
<span class="linenr"> 74: </span><span style="color: #0000ff; background-color: #EEF5FE;">Nel = Nelm;</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span><span style="color: #0000ff; background-color: #EEF5FE;">Nd = ((np.sqrt(1+8*Nel)-1)/2).astype(int); # Solution of Nd(Nd+1)/2-Nel = 0</span>
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span><span style="color: #0000ff; background-color: #EEF5FE;">M = np.zeros((Nd,Nd));</span>
<span class="linenr"> 79: </span><span style="color: #0000ff; background-color: #EEF5FE;">K = np.zeros((Nd,Nd));</span>
<span class="linenr"> 80: </span>
<span class="linenr"> 81: </span><span style="color: #0000ff; background-color: #EEF5FE;">(xi,yi) = np.tril_indices(Nd);</span>
<span class="linenr"> 82: </span><span style="color: #0000ff; background-color: #EEF5FE;">M[xi,yi] = Mv;</span>
<span class="linenr"> 83: </span><span style="color: #0000ff; background-color: #EEF5FE;">M[yi,xi] = Mv;</span>
<span class="linenr"> 84: </span><span style="color: #0000ff; background-color: #EEF5FE;">K[xi,yi] = Kv;</span>
<span class="linenr"> 85: </span><span style="color: #0000ff; background-color: #EEF5FE;">K[yi,xi] = Kv;</span>
<span class="linenr"> 86: </span>
<span class="linenr"> 87: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.")</span>
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Reading Forcing Vector from mtx file.");</span>
<span class="linenr"> 90: </span><span style="color: #0000ff; background-color: #EEF5FE;">Fvdat = np.loadtxt('.FVEC.mtx');</span>
<span class="linenr"> 91: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.");</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Processing Force Vector.");</span>
<span class="linenr"> 94: </span><span style="color: #0000ff; background-color: #EEF5FE;">Fv = np.zeros(M.shape[0]);</span>
<span class="linenr"> 95: </span><span style="color: #0000ff; background-color: #EEF5FE;">ids = range(np.where(np.diff(Fvdat[:, 1])==0)[0][0], Fvdat.shape[0])</span>
<span class="linenr"> 96: </span><span style="color: #0000ff; background-color: #EEF5FE;">n1dofnds = Fvdat[ids, 0].astype(int)</span>
<span class="linenr"> 97: </span><span style="color: #0000ff; background-color: #EEF5FE;">n3dofnds = Fvdat[list(set(range(Fvdat.shape[0]))-set(ids)), 0].astype(int)</span>
<span class="linenr"> 98: </span><span style="color: #0000ff; background-color: #EEF5FE;">Fv[((n3dofnds-1)*3+np.kron(np.ones(int(len(n3dofnds)/3)),[0, 1, 2])).astype(int)] = \</span>
<span class="linenr"> 99: </span><span style="color: #0000ff; background-color: #EEF5FE;">Fvdat[list(set(range(Fvdat.shape[0]))-set(ids)), 2]</span>
<span class="linenr">100: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Whew.")</span>
<span class="linenr">101: </span><span style="color: #0000ff; background-color: #EEF5FE;">Fv[range(-len(n1dofnds), 0)] = Fvdat[ids, 2]</span>
<span class="linenr">102: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Done.")</span>
<span class="linenr">103: </span>
<span class="linenr">104: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Matrix extraction complete - writing mat file")</span>
<span class="linenr">105: </span><span style="color: #0000ff; background-color: #EEF5FE;">dict = {"M": M, "K": K, "R": R.T, "Fv": Fv.reshape((len(Fv),1))};</span>
<span class="linenr">106: </span><span style="color: #0000ff; background-color: #EEF5FE;">io.savemat(".out.mat",dict);</span>
<span class="linenr">107: </span><span style="color: #0000ff; background-color: #EEF5FE;">print("Processing Over")</span>
<span class="linenr">108: </span><span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
<span class="linenr">109: </span>mv .out.mat $<span style="color: #BA36A5;">OUT</span>
<span class="linenr">110: </span>rm .STIFFNESS.mtx .MASS.mtx .RECOV.mtx .FVEC.mtx
</pre>
</div>
<ul class="org-ul">
<li>This bash script first uses <a href="https://www.gnu.org/software/gawk/manual/gawk.html">GNU Awk</a>, a simple but powerful utility that allows line-by-line parsing of files.</li>
<li>The script also uses the <a href="https://www.gnu.org/software/coreutils/cut">cut</a> utility from <a href="https://www.gnu.org/software/coreutils/cut">GNU coreutils</a> for manipulations.</li>
<li>Finally, the script uses Python (compatible with 2/3), involving numpy and scipy.io, for converting the quantities into a MATLAB mat-file that can be loaded on MATLAB.</li>
<li><p>
This script can be called as follows:
</p>
<div class="org-src-container">
<pre class="src src-bash">./readwritematvec.sh Modelmats.mtx
</pre>
</div></li>
<li>In windows, this can be done either through <a href="https://www.cygwin.com/">Cygwin</a> or <a href="https://learn.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a>.</li>
</ul></li>
<li>It may be possible to do this natively in MATLAB, but since this requires a line-parser, awk is better suited for the job than MATLAB.
A MATLAB implementation might require loading the whole file into memory for speed.
Line-parsing on MATLAB was extremely slow for me.</li>
</ol>
<p>
The file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step3.cae">model_step3.cae</a> is the final cae file that contains all of the above.
</p>
</div>
</div>
<div id="outline-container-sec:nlan" class="outline-3">
<h3 id="sec:nlan"><span class="section-number-3">6.2.</span> Nonlinear Analysis on MATLAB/OCTAVE in under 100 lines of code&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-sec:nlan">
<p>
We will now do our first nonlinear analysis on MATLAB/OCTAVE with the exported matrices.
We will conduct a <b>Nonlinear Prestress Analysis</b> for a frictionless contact with a unilateral spring on the normal direction.
</p>

<p>
It is assumed that the <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/readwritematvec.sh">readwritematvec.sh</a> routine has been called on matrix file named <code>Modelmats.mtx</code> to produce <code>Modelmats.mat</code> mat-file.
Further, the nodes and elements on the interface are taken to be available in <code>Nodes.dat</code> and <code>Elements.dat</code> files respectively.
The below tutorial is meant to be minimal so it is assumed that all the elements are linear QUAD elements.
</p>
<ol class="org-ol">
<li><p>
We start with the preamble for the MATLAB file, then read the mesh information, and then load up the matrices from the <code>Modelmats.mat</code> file.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>clc
<span class="linenr"> 2: </span>clear all
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultAxesTickLabelInterpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'default'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 5: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultTextInterpreter'</span><span style="color: #006FE0;">,</span><span style="color: #008000;">'latex'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 6: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span> <span style="color: #008000;">'DefaultLegendInterpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 7: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultAxesFontSize'</span><span style="color: #006FE0;">,</span>13<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Read Nodes and Elements</span>
<span class="linenr">10: </span>Nodes <span style="color: #006FE0;">=</span> dlmread<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./Nodes.dat'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">11: </span>Elements <span style="color: #006FE0;">=</span> dlmread<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./Elements.dat'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">12: </span>N <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Number of nodes per side</span>
<span class="linenr">13: </span>Ne <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Elements<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Number of elements</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Load Matrices</span>
<span class="linenr">16: </span>fname <span style="color: #006FE0;">=</span> <span style="color: #008000;">'./Modelmats.mat'</span><span style="color: #006FE0;">;</span>
<span class="linenr">17: </span>load<span style="color: #00ffff; font-weight: bold;">(</span>fname<span style="color: #006FE0;">,</span> <span style="color: #008000;">'M'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'K'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'R'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Fv'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Number of generalized modal DOFs</span>
<span class="linenr">20: </span>Nint <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>M<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">-</span><span style="color: #00ffff; font-weight: bold;">(</span>2<span style="color: #006FE0;">*</span>N<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">*</span>3<span style="color: #006FE0;">;</span>
</pre>
</div></li>
<li>It may be tempting to want to use <b>node-to-node contact elements</b>.
But this is <b>inconsistent here</b> since the elements have non-uniform area and have non-trivial connectivity.
In the continuous case, the nodal-force-traction relationship is expressed as
\[ f_j = \int_\Omega \mathbb{N}_j t(\mathbb{x}) d\Omega, \]
where \(\mathbb{N}_j\) is the \(j^{th}\) shape function, \(f_j\) is the nodal force of the \(j^{th}\) node, and \(t(\mathbb{x})\) is the traction-field (of the appropriate traction).<br />
<b>Contact-constitutive models are understood as local relationships between the relative displacement and contact tractions.</b>
Nodal forces are merely integral effects of the local traction distributions.<br />
It is therefore <b>necessary to employ quadrature integration</b> for consistency.</li>
<li><p>
The implementation greatly simplifies if we were to employ only a single Quadrature Point (QP) per element.
We construct two matrices, \(Q_m\) and \(T_m\) such that
</p>
\begin{align*}
x_{QP} &= Q_{m} x_N \text{, and}\\
f_N &= T_{m} t_{QP}.
\end{align*}
<p>
Here, \(x_{QP}\) and \(x_N\) are the vector of displacements at quadrature points and nodal points respectively; and
\(f_N\) and \(t_{QP}\) are the vector of nodal forces and quadrature point tractions respectively.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">21: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Single-Point-Quadrature Matrices</span>
<span class="linenr">22: </span>Qm <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>Ne<span style="color: #006FE0;">,</span> N<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Each element has one quadrature point</span>
<span class="linenr">23: </span>Tm <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>N<span style="color: #006FE0;">,</span> Ne<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Each quadrature pt integrated to 4 nodes</span>
<span class="linenr">24: </span>Ars <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>Ne<span style="color: #006FE0;">,</span> 1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Vector of areas of each element</span>
<span class="linenr">25: </span><span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
<span class="linenr">26: </span>    ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
<span class="linenr">27: </span>    Qm<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> ones<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #006FE0;">,</span> 4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">/</span>4<span style="color: #006FE0;">;</span>
<span class="linenr">28: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #8D8D84; font-style: italic;">% value @ QP = avg of nodal values</span>
<span class="linenr">29: </span>             
<span class="linenr">30: </span>    Ars<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> polyarea<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>2<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span>    Tm<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ei<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> ones<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #006FE0;">,</span> 1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">*</span>Ars<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">/</span>4<span style="color: #006FE0;">;</span>
<span class="linenr">33: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #8D8D84; font-style: italic;">% (integrated) nodal value = value @ QP times element Area/4</span>
<span class="linenr">34: </span><span style="color: #0000FF;">end</span>
<span class="linenr">35: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Qm is quadrature interpolation matrix</span>
<span class="linenr">36: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Tm is quadrature integration matrix</span>
<span class="linenr">37: </span>
<span class="linenr">38: </span>Ar_tot <span style="color: #006FE0;">=</span> 120e<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">*</span>25.4e<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">*</span>pi<span style="color: #006FE0;">*</span><span style="color: #00ffff; font-weight: bold;">(</span>0.85e<span style="color: #006FE0;">-</span>2<span style="color: #006FE0;">/</span>2<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">^</span>2<span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% True total area</span>
<span class="linenr">39: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>   <span style="color: #8D8D84; font-style: italic;">% Rectangle-3*Circles</span>
<span class="linenr">40: </span>Ar_avg <span style="color: #006FE0;">=</span> Ar_tot<span style="color: #006FE0;">/</span>Ne<span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Average element area</span>
</pre>
</div>
<p>
The fact that for a single quadrature point case, the quadrature point is exactly at the centroid of the element.
For the integral, this assumes that the traction field within each element is uniform, so the integral may be simplified as
\[ f_j = \int_{\Omega_e} \mathbb{N}_j t(\mathbb{x}) d\Omega \approxeq t_{QP} \underbrace{\int_{\Omega_e} \mathbb{N}_j d\Omega}_{A_e/4,} \]
with \(A_e\) denoting element area, and \(\Omega_e\) denoting element domain (surface).
The interpolation and integration weights are, therefore, easily specified.
The following is a depiction of the quadrature points against the interfacial elements.
</p>

<div id="org9fa8d90" class="figure">
<p><img src="./figs/quadpts.png" alt="quadpts.png" width="600px" />
</p>
</div></li>
<li><p>
We now construct a matrix \(L_{rel}\) such that \(L_{rel}x_{cms}\) gives an \(N\times 1\) array of interfacial relative displacements in the normal direction.
This is written based on the fact that the CMS model first lists out all the nodal DOFs of the top interface (\(x, y, z\), in that order), and then lists out the DOFs of the bottom interface nodes.
So the relative normal displacement is defined as \(\Delta z:=x_{z,top}-x_{z,bot}\), such that \(\Delta z>0\) implies contact and \(\Delta z<0\) implies separation.
</p>

<p>
The following code derives the matrix \(L_{rel}\) to obtain the relative displacement at the quadrature location from the system's global vector of DOFs (CMS DOFs).
Further, a matrix \(G_{rel}\) is also constructed such that \(G_{rel} t_{z,rel,QP}\) represents the nodal forces when \(t_{z,rel,QP}\) is the normal tractions at the quadrature points.
Finally, nodal relative displacements are also computed (just for plotting purposes).
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">41: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Contact Relative Displacements</span>
<span class="linenr">42: </span>Lz <span style="color: #006FE0;">=</span> kron<span style="color: #00ffff; font-weight: bold;">(</span>Qm<span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>0 0 1<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get only normal displacement</span>
<span class="linenr">43: </span>Lrel <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>Lz <span style="color: #006FE0;">-</span>Lz zeros<span style="color: #00ff00;">(</span>Ne<span style="color: #006FE0;">,</span> Nint<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span>
<span class="linenr">44: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Lrel defd such that Lrel*x&gt;0 implies contact and Lrel*x&lt;0 implies separation.</span>
<span class="linenr">45: </span>
<span class="linenr">46: </span>Gz <span style="color: #006FE0;">=</span> kron<span style="color: #00ffff; font-weight: bold;">(</span>Tm<span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>0<span style="color: #006FE0;">;</span> 0<span style="color: #006FE0;">;</span> 1<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">47: </span>Grel <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>Gz<span style="color: #006FE0;">;</span> <span style="color: #006FE0;">-</span>Gz<span style="color: #006FE0;">;</span> zeros<span style="color: #00ff00;">(</span>Nint<span style="color: #006FE0;">,</span> Ne<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span>
<span class="linenr">48: </span>
<span class="linenr">49: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Nodal relative disp (only for plotting)</span>
<span class="linenr">50: </span>Lz_n <span style="color: #006FE0;">=</span> kron<span style="color: #00ffff; font-weight: bold;">(</span>eye<span style="color: #00ff00;">(</span>N<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>0 0 1<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get only normal displacement</span>
<span class="linenr">51: </span>Lrel_n <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>Lz_n <span style="color: #006FE0;">-</span>Lz_n zeros<span style="color: #00ff00;">(</span>N<span style="color: #006FE0;">,</span> Nint<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span>
</pre>
</div></li>
<li><p>
Now we construct a null-space projection matrix \(L_n\) such that \(x_{cms} = L_n x_{nred}\), where \(x_{nred}\) is the null space reduced set of DOFs (\(N_{cms}-6\)).
Note that the matrix \(L_1^T K L_1\) has only 6 RBMs (and not 7) since the interfaces have been stuck together by the \(L_1\) matrix.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">52: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Remove fixed interface null-space</span>
<span class="linenr">53: </span>L1 <span style="color: #006FE0;">=</span> null<span style="color: #00ffff; font-weight: bold;">(</span>Lrel<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">54: </span><span style="color: #00ffff; font-weight: bold;">[</span>V<span style="color: #006FE0;">,</span>D<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> eigs<span style="color: #00ffff; font-weight: bold;">(</span>L1<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>L1<span style="color: #006FE0;">,</span> L1<span style="color: #006FE0;">'*</span>M<span style="color: #006FE0;">*</span>L1<span style="color: #006FE0;">,</span> 20<span style="color: #006FE0;">,</span> <span style="color: #008000;">'SM'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get first 20 modes</span>
<span class="linenr">55: </span>Ln <span style="color: #006FE0;">=</span> null<span style="color: #00ffff; font-weight: bold;">(</span>V<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span> 1<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">'*</span>L1<span style="color: #006FE0;">'*</span>M<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% First six modes are RBMs</span>
<span class="linenr">56: </span>
<span class="linenr">57: </span>Nn <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">,</span> 2<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Null-reduced DOFs</span>
</pre>
</div></li>
<li><p>
Now conduct the nonlinear prestress simulation using a uniform penalty stiffness of \(5\times 10^6 Pa m^{-1}\) (units of traction per displacement).
The normal contact is simulated using a penalty stiffness formulation for simplicity.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">58: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Solve the Nonlinear Static Prestress Problem</span>
<span class="linenr">59: </span>bpmag <span style="color: #006FE0;">=</span> 12e3<span style="color: #006FE0;">;</span>
<span class="linenr">60: </span>knl <span style="color: #006FE0;">=</span> 5e6<span style="color: #006FE0;">/</span><span style="color: #00ffff; font-weight: bold;">(</span>Ar_tot<span style="color: #006FE0;">/</span>Ne<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% knl divided by avg element area</span>
<span class="linenr">61: </span>U0 <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>Ln <span style="color: #006FE0;">+</span> <span style="color: #00ff00;">(</span>Grel<span style="color: #006FE0;">'*</span>Ln<span style="color: #00ff00;">)</span><span style="color: #006FE0;">'*</span><span style="color: #00ff00;">(</span>Lrel<span style="color: #006FE0;">*</span>Ln<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>knl<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">\</span><span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">'*</span>Fv<span style="color: #006FE0;">*</span>bpmag<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">62: </span>
<span class="linenr">63: </span>opt <span style="color: #006FE0;">=</span> optimoptions<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'fsolve'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'specifyObjectiveGradient'</span><span style="color: #006FE0;">,</span> true<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">64: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>  <span style="color: #008000;">'Display'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'iter'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">65: </span><span style="color: #00ffff; font-weight: bold;">[</span>U0<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">~,</span> <span style="color: #006FE0;">~,</span> <span style="color: #006FE0;">~,</span> J0<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> fsolve<span style="color: #00ffff; font-weight: bold;">(</span>@<span style="color: #00ff00;">(</span>U<span style="color: #00ff00;">)</span> RESFUN<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>U<span style="color: #006FE0;">;</span> bpmag<span style="color: #1e90ff;">]</span><span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>Fv<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">66: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>  Lrel<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>Grel<span style="color: #006FE0;">,</span> knl<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> U0<span style="color: #006FE0;">,</span> opt<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">67: </span>                                     
<span class="linenr">68: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Linearized Modal Analysis</span>
<span class="linenr">69: </span><span style="color: #00ffff; font-weight: bold;">[</span>V0<span style="color: #006FE0;">,</span> D0<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> eigs<span style="color: #00ffff; font-weight: bold;">(</span>J0<span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>M<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> 10<span style="color: #006FE0;">,</span> <span style="color: #008000;">'SM'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">70: </span>W0 <span style="color: #006FE0;">=</span> sqrt<span style="color: #00ffff; font-weight: bold;">(</span>diag<span style="color: #00ff00;">(</span>D0<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">71: </span>disp<span style="color: #00ffff; font-weight: bold;">(</span>table<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>10<span style="color: #1e90ff;">)</span><span style="color: #006FE0;">',</span> W0<span style="color: #006FE0;">/</span>2<span style="color: #006FE0;">/</span>pi<span style="color: #006FE0;">,</span> <span style="color: #008000;">'VariableNames'</span><span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">72: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>  <span style="color: #1e90ff;">{</span><span style="color: #008000;">'Index'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Frequency (Hz)'</span><span style="color: #1e90ff;">}</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
The last few lines conduct a modal analysis from the prestressed state.
As of the time of writing, convergence was observed in about 21 iterations (using MATLAB R2022a).
This prints the following table of the elastic modes:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-right">Frequency (Hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">143.74</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">151.3</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">575.08</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">642.81</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">870.59</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">945.37</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1130.3</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1476.4</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1701.3</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1893.6</td>
</tr>
</tbody>
</table></li>
</ol>
<p>
This completes the analysis, and the next two action points will do some plotting of the results.
</p>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #cccccc;
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Static Residue Routine RESFUN.m
                      </font>
                    </strong>
                  </summary>
<p>
The following routine returns the quasi-static residue for a given normal load.
Only a unilateral spring is considered in the normal direction.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #0000FF;">function</span> <span style="color: #00ffff; font-weight: bold;">[</span>R<span style="color: #006FE0;">,</span> dRdU<span style="color: #006FE0;">,</span> dRdf<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> <span style="color: #006699;">RESFUN</span><span style="color: #00ffff; font-weight: bold;">(</span>Uf<span style="color: #006FE0;">,</span> K<span style="color: #006FE0;">,</span> Fv<span style="color: #006FE0;">,</span> Lc<span style="color: #006FE0;">,</span> Gc<span style="color: #006FE0;">,</span> knl<span style="color: #00ffff; font-weight: bold;">)</span>
    fnl_pred <span style="color: #006FE0;">=</span> knl<span style="color: #006FE0;">*</span>Lc<span style="color: #006FE0;">*</span>Uf<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #006FE0;">:</span>end<span style="color: #006FE0;">-</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>      <span style="color: #8D8D84; font-style: italic;">% Predicted normal force</span>
    fnl <span style="color: #006FE0;">=</span> max<span style="color: #00ffff; font-weight: bold;">(</span>fnl_pred<span style="color: #006FE0;">,</span> 0<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>             <span style="color: #8D8D84; font-style: italic;">% Saturated @ 0: unilateral spring</span>

    jnl <span style="color: #006FE0;">=</span> knl<span style="color: #006FE0;">*</span>Lc<span style="color: #006FE0;">;</span>                       <span style="color: #8D8D84; font-style: italic;">% Jacobian</span>
    jnl<span style="color: #00ffff; font-weight: bold;">(</span>fnl<span style="color: #006FE0;">==</span>0<span style="color: #006FE0;">,:</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> 0<span style="color: #006FE0;">;</span>                  

    <span style="color: #8D8D84; font-style: italic;">% Static Residue</span>
    R <span style="color: #006FE0;">=</span> K<span style="color: #006FE0;">*</span>Uf<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #006FE0;">:</span>end<span style="color: #006FE0;">-</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">+</span>Gc<span style="color: #006FE0;">*</span>fnl <span style="color: #006FE0;">-</span> Fv<span style="color: #006FE0;">*</span>Uf<span style="color: #00ffff; font-weight: bold;">(</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
    dRdU <span style="color: #006FE0;">=</span> K<span style="color: #006FE0;">+</span>Gc<span style="color: #006FE0;">*</span>Lc<span style="color: #006FE0;">*</span>knl<span style="color: #006FE0;">;</span>
    dRdf <span style="color: #006FE0;">=</span> <span style="color: #006FE0;">-</span>Fv<span style="color: #006FE0;">;</span>
<span style="color: #0000FF;">end</span>
</pre>
</div>


</details>
</div>
<div id="outline-container-orgb8e5b15" class="outline-4">
<h4 id="orgb8e5b15"><span class="section-number-4">6.2.1.</span> Plotting</h4>
<div class="outline-text-4" id="text-6-2-1">
<ol class="org-ol">
<li><p>
We next construct a <code>MATLAB Graph</code> object using the element information and plot out the relative normal displacements at the interface as a graph.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Depict Interfacial Displacement Field</span>
A <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>N<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Graph adjacency matrix</span>
<span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
    <span style="color: #c05fc05fc05f;"> </span>  ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
    <span style="color: #c05fc05fc05f;"> </span>  A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">+</span> eye<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
    <span style="color: #c05fc05fc05f;"> </span>  A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">+</span> eye<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span style="color: #0000FF;">end</span>
G <span style="color: #006FE0;">=</span> graph<span style="color: #00ffff; font-weight: bold;">(</span>A<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>

figure<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #00ffff; font-weight: bold;">)</span>
pos<span style="color: #006FE0;">=</span>get<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
set<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>pos<span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>2<span style="color: #1e90ff;">)</span> 900 320<span style="color: #00ff00;">]</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Color'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'white'</span><span style="color: #00ffff; font-weight: bold;">)</span>
clf<span style="color: #00ffff; font-weight: bold;">()</span>
plot<span style="color: #00ffff; font-weight: bold;">(</span>G<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XData'</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'YData'</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span>2<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
    <span style="color: #c05fc05fc05f;"> </span><span style="color: #008000;">'NodeCData'</span><span style="color: #006FE0;">,</span> Lrel_n<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">*</span>U0<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
    <span style="color: #c05fc05fc05f;"> </span><span style="color: #008000;">'MarkerSize'</span><span style="color: #006FE0;">,</span> 4<span style="color: #006FE0;">,</span> <span style="color: #008000;">'LineWidth'</span><span style="color: #006FE0;">,</span> 3<span style="color: #00ffff; font-weight: bold;">)</span>
colormap<span style="color: #00ffff; font-weight: bold;">(</span>jet<span style="color: #00ffff; font-weight: bold;">)</span>
grid on
axis equal
axis tight
set<span style="color: #00ffff; font-weight: bold;">(</span>gca<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XTick'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">(</span><span style="color: #006FE0;">-</span>6<span style="color: #006FE0;">:</span>3<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>1e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
xlabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'X Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
ylabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Y Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
xx<span style="color: #006FE0;">=</span>colorbar<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'SouthOutside'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
xlabel<span style="color: #00ffff; font-weight: bold;">(</span>xx<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Nodal Relative Displacement (m)'</span><span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
    <span style="color: #c05fc05fc05f;"> </span>  <span style="color: #008000;">'interpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'fontsize'</span><span style="color: #006FE0;">,</span> 13<span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
The following is the output figure, showing the relative normal displacements at each node, with the nodes connected through the undirected graph constructed using the element information.
</p>

<div id="org15dd40e" class="figure">
<p><img src="./figs/intdisps.png" alt="intdisps.png" width="600px" />
</p>
</div></li>
<li><p>
We can also plot the interfacial normal tractions by evaluating the contact model at the quadrature points and plotting them.
Since we have just a single quadrature point per element, each element is filled in with a constant color.
If multiple quadrature points are available, we can do a least-squares solve to obtain "nodal traction values", which will show the intra-element gradients also.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Show Pressure field</span>
pvals <span style="color: #006FE0;">=</span> max<span style="color: #00ffff; font-weight: bold;">(</span>knl<span style="color: #006FE0;">*</span>Lrel<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">*</span>U0<span style="color: #006FE0;">,</span> 0<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% pressure @ QPs</span>
figure<span style="color: #00ffff; font-weight: bold;">(</span>3<span style="color: #00ffff; font-weight: bold;">)</span>
pos<span style="color: #006FE0;">=</span>get<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
set<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>pos<span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>2<span style="color: #1e90ff;">)</span> 900 320<span style="color: #00ff00;">]</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Color'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'white'</span><span style="color: #00ffff; font-weight: bold;">)</span>
clf<span style="color: #00ffff; font-weight: bold;">()</span>
<span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
    ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
    fill<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>2<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> pvals<span style="color: #00ff00;">(</span>ei<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> hold on
<span style="color: #0000FF;">end</span>
colormap<span style="color: #00ffff; font-weight: bold;">(</span>jet<span style="color: #00ffff; font-weight: bold;">)</span>
grid on
axis equal
axis tight
set<span style="color: #00ffff; font-weight: bold;">(</span>gca<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XTick'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">(</span><span style="color: #006FE0;">-</span>6<span style="color: #006FE0;">:</span>3<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>1e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
xlabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'X Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
ylabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Y Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
xx<span style="color: #006FE0;">=</span>colorbar<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'SouthOutside'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
xlabel<span style="color: #00ffff; font-weight: bold;">(</span>xx<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Element Normal Pressure (Pa)'</span><span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
    <span style="color: #c05fc05fc05f;"> </span>  <span style="color: #008000;">'interpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'fontsize'</span><span style="color: #006FE0;">,</span> 13<span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
Here is the output of the above plotting.
The non-trivial normal traction distribution is clearly observed.
Higher values of \(knl\) will obtain a better estimate of the "hard" contact results obtained from ABAQUS earlier.
An alternative would be to implement a lagrange multiplier method for conducting hard contact simulations directly.
</p>

<div id="org37d423d" class="figure">
<p><img src="./figs/intpress.png" alt="intpress.png" width="600px" />
</p>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org3441099" class="outline-4">
<h4 id="org3441099"><span class="section-number-4">6.2.2.</span> Miscellanies</h4>
<div class="outline-text-4" id="text-6-2-2">
<ol class="org-ol">
<li>Even if all the nodes have equal areas, <b>node-to-node contact elements are still inconsistent in this context</b>, since contact interactions can be understood to be a fundamentally local interaction, which need to be integrated to have global influence.
Quadrature-based integration of local tractions to nodal forces conducts exactly this.
Please see <a href="https://www.sciencedirect.com/science/article/abs/pii/S0888327020300017">this paper</a> for a quadrature-based implementation for the BRB using a rought contact-based frictional model in the interface.</li>
<li>You can quite easily implement a friction model also in <code>RESFUN.m</code> above.
This, along with appropriately defined relative displacement matrices will be all you need to get started with your first nonlinear dynamic analysis (that may take more than just 100 lines of code, however ;-) )!
You can look at <a href="https://asmedigitalcollection.asme.org/appliedmechanicsreviews/article/72/4/040802/1084997/A-Review-of-Damping-Models-for-Structures-With?casa_token=JWwE4Nf3808AAAAA:266N8zS75p4KrKsaZLrVHrnMfOSyZoq3urnmMf1QbWvJbDrWQYw6FJcpYFmffulGetIYTnMAlA">this paper</a> for a list of potential contact models to employ.</li>
<li>Do check out <a href="https://www.sciencedirect.com/science/article/abs/pii/S0888327018305739">QSMA</a> (Quasistatic Modal Analysis) and <a href="https://www.sciencedirect.com/science/article/abs/pii/S0045794919315160">RQNM</a> (Rayleigh Quotient-based Nonlinear Modal Analysis).
These are two powerful quasi-static nonlinear modal analysis approaches that can be implemented using a routine that is not so much more complicated than the above.
The advantage will be that using such cheap simulations, remarkable insights can be gathered about the (near-resonant) vibration behavior of the structure.</li>
<li>It is often beneficial in this context to use <b>relative coordinates</b> at the interface (so we can get a 2x reduction in the total number of unknowns in the problem). 
You can do this in MATLAB on the HCB reduced model, or you can do this directly in the ABAQUS model by introducing ghost nodes representing the relative displacements.
This is optional, but recommended - see instructions in <a href="cref:sec:relcsp">cref:sec:relcsp</a>.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-sec:relcsp" class="outline-2">
<h2 id="sec:relcsp"><span class="section-number-2">7.</span> Relative Coordinates Pipeline</h2>
<div class="outline-text-2" id="text-sec:relcsp">
<p>
In <a href="cref:sec:meshproc">cref:sec:meshproc</a> and <a href="cref:sec:mex">cref:sec:mex</a>, the true nodal DOFS of the interfacial nodes are extracted for the HCBCMS.
Here, we instead extract the relative coordinates directly by introducing a set of <b>ghost nodes</b> at the interface whose DOFs are set to be equal to the difference between the DOFs of the top and bottom nodes.
We achieve this by creating Reference Point instances at the appropriate locations and constraining them using the <b>EQUATION</b> constraint.
</p>

<p>
Note that we will first insert the reference points into the model (<a href="cref:sec:insrpt">cref:sec:insrpt</a>) and the write the resulting model into an inp file.
<b>I have been unable to figure out a way to do this fully natively with the cae model object, since the node IDs of the reference point instances don't seem to be available unless we are just about to do the analysis.</b>
If someone can figure this out, please <a href="mailto:nidbid@gmail.com">write to me</a>
</p>

<p>
We start with the file <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/assembly/model_step1a.cae">model_step1a.cae</a> for this.
</p>
</div>
<div id="outline-container-sec:insrpt" class="outline-3">
<h3 id="sec:insrpt"><span class="section-number-3">7.1.</span> Insertion of Reference Point Instances&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Script">Script</span></span></h3>
<div class="outline-text-3" id="text-sec:insrpt">
<ol class="org-ol">
<li><p>
Load the cae file along with the necessary preamble.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span style="color: #0000FF;">import</span> sys
<span class="linenr"> 2: </span><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">from</span> part <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">from</span> material <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">from</span> section <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">from</span> assembly <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 8: </span><span style="color: #0000FF;">from</span> step <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">from</span> interaction <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">10: </span><span style="color: #0000FF;">from</span> load <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">11: </span><span style="color: #0000FF;">from</span> mesh <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">12: </span><span style="color: #0000FF;">from</span> optimization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">13: </span><span style="color: #0000FF;">from</span> job <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">14: </span><span style="color: #0000FF;">from</span> sketch <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">15: </span><span style="color: #0000FF;">from</span> visualization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">16: </span><span style="color: #0000FF;">from</span> connectorBehavior <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #0000FF;">from</span> abaqus <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">19: </span><span style="color: #0000FF;">from</span> abaqusConstants <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">20: </span><span style="color: #0000FF;">from</span> caeModules <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span> 
<span class="linenr">21: </span><span style="color: #0000FF;">import</span> regionToolset
<span class="linenr">22: </span><span style="color: #0000FF;">import</span> job
<span class="linenr">23: </span><span style="color: #0000FF;">import</span> step
<span class="linenr">24: </span><span style="color: #0000FF;">import</span> sets
<span class="linenr">25: </span>
<span class="linenr">26: </span><span style="color: #0000FF;">from</span> inpParser <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #BA36A5;">mdbm</span> <span style="color: #0000FF;">=</span> <span style="color: #006DAF;">openMdb</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./model_step1a.cae'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">29: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdbm.<span style="color: #D0372D; font-style: italic;">models</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">30: </span><span style="color: #BA36A5;">ras</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">rootAssembly</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span>mdl.<span style="color: #006DAF; font-style: italic;">setValues</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">noPartsInputFile</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Get the nodes of only the top surface
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">33: </span><span style="color: #BA36A5;">topsurf</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'TOPBEAM'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'INSURF'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">34: </span><span style="color: #BA36A5;">topnodes</span> <span style="color: #0000FF;">=</span> topsurf.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">35: </span><span style="color: #BA36A5;">N</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>topnodes<span style="color: #00ffff; font-weight: bold;">)</span>  <span style="color: #8D8D84; font-style: italic;"># Number of nodes</span>
<span class="linenr">36: </span><span style="color: #8D8D84; font-style: italic;"># Top Nodes &amp; Coordinates</span>
<span class="linenr">37: </span><span style="color: #BA36A5;">Topnd_dict</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">dict</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">zip</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>topnodes<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff00ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">]</span>, <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">38: </span><span style="color: #BA36A5;">TopNdCds</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>topnodes<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Import the reference point (partname: <code>REFPT</code>) as instances into the assembly and move them to the nodal locations.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">39: </span><span style="color: #BA36A5;">rpt</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">parts</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'REFPT'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">40: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">41: </span>    ras.<span style="color: #6434A3; font-style: italic;">Instance</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'RELPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">part</span><span style="color: #0000FF;">=</span>rpt, <span style="color: #808080;">dependent</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">OFF</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">42: </span>    ras.<span style="color: #006DAF; font-style: italic;">translate</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">instanceList</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #008000;">'RELPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span>, <span style="color: #00ff00;">)</span>, <span style="color: #808080;">vector</span><span style="color: #0000FF;">=</span>topnodes<span style="color: #00ff00;">[</span>i<span style="color: #00ff00;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Create a set of the reference points, then simplify the model, and save the resulting model to an inp file.
The name of the resulting inp file will be <code>MeshedModel.inp</code>.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">43: </span>ras.<span style="color: #6434A3; font-style: italic;">Set</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'RELCSET'</span>,
<span class="linenr">44: </span>        <span style="color: #808080;">referencePoints</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">[</span>ras.<span style="color: #D0372D; font-style: italic;">instances</span><span style="color: #1e90ff;">[</span><span style="color: #008000;">'RELPT-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">referencePoints</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">]</span>
<span class="linenr">45: </span>                         <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span> <span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">46: </span>
<span class="linenr">47: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">interactions</span>
<span class="linenr">48: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">0</span>:
<span class="linenr">49: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">50: </span>
<span class="linenr">51: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">interactionProperties</span>
<span class="linenr">52: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">0</span>:
<span class="linenr">53: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span><span style="color: #8D8D84; font-style: italic;"># Remove all steps except initial</span>
<span class="linenr">56: </span><span style="color: #BA36A5;">tmp</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">steps</span>
<span class="linenr">57: </span><span style="color: #0000FF;">while</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>tmp<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #0000FF;">&gt;</span> <span style="color: #D0372D;">1</span>:
<span class="linenr">58: </span>    <span style="color: #0000FF;">del</span> tmp<span style="color: #00ffff; font-weight: bold;">[</span>tmp.<span style="color: #006DAF; font-style: italic;">keys</span><span style="color: #00ff00;">()[</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">59: </span>
<span class="linenr">60: </span><span style="color: #8D8D84; font-style: italic;">#### 5. Create a Job and write an inp file</span>
<span class="linenr">61: </span>mdbm.<span style="color: #6434A3; font-style: italic;">Job</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"MeshedModel"</span>, <span style="color: #808080;">model</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">62: </span>mdbm.<span style="color: #D0372D; font-style: italic;">jobs</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'MeshedModel'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #006DAF; font-style: italic;">writeInput</span><span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">63: </span>
<span class="linenr">64: </span>mdbm.<span style="color: #006DAF; font-style: italic;">close</span><span style="color: #00ffff; font-weight: bold;">()</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgb28f57f" class="outline-3">
<h3 id="orgb28f57f"><span class="section-number-3">7.2.</span> Process the inp-file model, renumber the bottom nodes, and conduct HCBCMS.</h3>
<div class="outline-text-3" id="text-7-2">
<ol class="org-ol">
<li><p>
We first read in the inp file we saved in the above.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr"> 1: </span><span style="color: #0000FF;">import</span> sys
<span class="linenr"> 2: </span><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">from</span> part <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">from</span> material <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">from</span> section <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">from</span> assembly <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 8: </span><span style="color: #0000FF;">from</span> step <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">from</span> interaction <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">10: </span><span style="color: #0000FF;">from</span> load <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">11: </span><span style="color: #0000FF;">from</span> mesh <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">12: </span><span style="color: #0000FF;">from</span> optimization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">13: </span><span style="color: #0000FF;">from</span> job <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">14: </span><span style="color: #0000FF;">from</span> sketch <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">15: </span><span style="color: #0000FF;">from</span> visualization <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">16: </span><span style="color: #0000FF;">from</span> connectorBehavior <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #0000FF;">from</span> abaqus <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">19: </span><span style="color: #0000FF;">from</span> abaqusConstants <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">20: </span><span style="color: #0000FF;">from</span> caeModules <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span> 
<span class="linenr">21: </span><span style="color: #0000FF;">import</span> regionToolset
<span class="linenr">22: </span><span style="color: #0000FF;">import</span> job
<span class="linenr">23: </span><span style="color: #0000FF;">import</span> step
<span class="linenr">24: </span><span style="color: #0000FF;">import</span> sets
<span class="linenr">25: </span>
<span class="linenr">26: </span><span style="color: #0000FF;">from</span> inpParser <span style="color: #0000FF;">import</span> <span style="color: #0000FF;">*</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span><span style="color: #BA36A5;">mdl</span> <span style="color: #0000FF;">=</span> mdb.<span style="color: #6434A3; font-style: italic;">ModelFromInputFile</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Model-1'</span>,
<span class="linenr">29: </span>                             <span style="color: #808080;">inputFileName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'./MeshedModel.inp'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">30: </span><span style="color: #BA36A5;">ras</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">rootAssembly</span>
</pre>
</div></li>
<li><p>
Following a process similar to that in <a href="cref:sec:meshproc">cref:sec:meshproc</a>, we renumber and align the bottom surface nodes to match the top surface nodes.
Note that since we have read the model from the inp file, all set names are fully upper case, and the concept of instances does not exist any more.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">31: </span><span style="color: #BA36A5;">topsurf</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'TOPBEAM_INSURF'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">32: </span><span style="color: #BA36A5;">botsurf</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">surfaces</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'BOTBEAM_INSURF'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">33: </span>
<span class="linenr">34: </span><span style="color: #BA36A5;">topnodes</span> <span style="color: #0000FF;">=</span> topsurf.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">35: </span><span style="color: #BA36A5;">botnodes</span> <span style="color: #0000FF;">=</span> botsurf.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">36: </span><span style="color: #BA36A5;">N</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">len</span><span style="color: #00ffff; font-weight: bold;">(</span>topnodes<span style="color: #00ffff; font-weight: bold;">)</span>  <span style="color: #8D8D84; font-style: italic;"># Number of nodes</span>
<span class="linenr">37: </span><span style="color: #BA36A5;">Topnd_dict</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">dict</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">zip</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>topnodes<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff00ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">]</span>, <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">38: </span><span style="color: #BA36A5;">TopNdCds</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>topnodes<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">N</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">39: </span>
<span class="linenr">40: </span><span style="color: #8D8D84; font-style: italic;"># Top Elements</span>
<span class="linenr">41: </span><span style="color: #BA36A5;">TopEls</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">connectivity</span>
<span class="linenr">42: </span>                   <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #006FE0;">len</span><span style="color: #ff00ff;">(</span>topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">43: </span><span style="color: #BA36A5;">ELS</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">zeros</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">(</span><span style="color: #6434A3;">TopEls</span>.<span style="color: #D0372D; font-style: italic;">shape</span><span style="color: #1e90ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #1e90ff;">]</span>, <span style="color: #D0372D;">5</span><span style="color: #00ff00;">)</span>, <span style="color: #808080;">dtype</span><span style="color: #0000FF;">=</span>int<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">44: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">ne</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #6434A3;">TopEls</span>.<span style="color: #D0372D; font-style: italic;">shape</span><span style="color: #00ff00;">[</span><span style="color: #D0372D;">0</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">45: </span>    <span style="color: #BA36A5;">elefac</span> <span style="color: #0000FF;">=</span> topsurf.<span style="color: #D0372D; font-style: italic;">elements</span><span style="color: #00ffff; font-weight: bold;">[</span>ne<span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #006DAF; font-style: italic;">getElemFaces</span><span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">46: </span>
<span class="linenr">47: </span>    <span style="color: #8D8D84; font-style: italic;"># Gives you the list of faces on the interface (we only expect a single face)</span>
<span class="linenr">48: </span>    <span style="color: #BA36A5;">fe</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">argwhere</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span><span style="color: #006FE0;">all</span><span style="color: #1e90ff;">(</span><span style="color: #ff00ff;">[</span><span style="color: #6434A3;">Topnd_dict</span>.<span style="color: #006DAF; font-style: italic;">has_key</span><span style="color: #ff8c00;">(</span>x<span style="color: #ff8c00;">)</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">x</span> <span style="color: #0000FF;">in</span> 
<span class="linenr">49: </span>                           <span style="color: #ff8c00;">[</span>elefac<span style="color: #00ffff;">[</span>k<span style="color: #00ffff;">]</span>.<span style="color: #006DAF; font-style: italic;">getNodes</span><span style="color: #00ffff;">()[</span>i<span style="color: #00ffff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff;">(</span><span style="color: #D0372D;">4</span><span style="color: #00ffff;">)</span><span style="color: #ff8c00;">]</span><span style="color: #ff00ff;">]</span><span style="color: #1e90ff;">)</span>
<span class="linenr">50: </span>                      <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">k</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">6</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)[</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">51: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, <span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">=</span> ne
<span class="linenr">52: </span>    <span style="color: #8D8D84; font-style: italic;"># Searches for &amp; returns the face where all the nodes are in the interface</span>
<span class="linenr">53: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, <span style="color: #D0372D;">1</span>:<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #6434A3;">Topnd_dict</span><span style="color: #00ff00;">[</span>x<span style="color: #00ff00;">]</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">x</span> <span style="color: #0000FF;">in</span> <span style="color: #00ff00;">[</span>elefac<span style="color: #1e90ff;">[</span>fe<span style="color: #1e90ff;">]</span>.<span style="color: #006DAF; font-style: italic;">getNodes</span><span style="color: #1e90ff;">()[</span>k<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span>
<span class="linenr">54: </span>                                           <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">k</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">55: </span>    <span style="color: #D0372D;">ELS</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #BA36A5;">ne</span>, :<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #0000FF;">+=</span> <span style="color: #D0372D;">1</span>
</pre>
</div>
<ol class="org-ol">
<li><p>
Resort the bottom nodes
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">56: </span><span style="color: #8D8D84; font-style: italic;"># Re-sort the bottom nodes    </span>
<span class="linenr">57: </span><span style="color: #BA36A5;">botleft</span> <span style="color: #0000FF;">=</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">58: </span><span style="color: #BA36A5;">bts</span> <span style="color: #0000FF;">=</span> <span style="color: #00ffff; font-weight: bold;">[]</span>
<span class="linenr">59: </span><span style="color: #BA36A5;">tmi</span> <span style="color: #0000FF;">=</span> <span style="color: #D0372D;">0</span>
<span class="linenr">60: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">61: </span>    <span style="color: #8D8D84; font-style: italic;"># Calculates deviation of selected node coordinate on bottom to each</span>
<span class="linenr">62: </span>    <span style="color: #8D8D84; font-style: italic;"># node coordinate on top and "assigns" the closest one to the index.</span>
<span class="linenr">63: </span>    bts.<span style="color: #006DAF; font-style: italic;">append</span><span style="color: #00ffff; font-weight: bold;">(</span>
<span class="linenr">64: </span>        botleft.<span style="color: #006DAF; font-style: italic;">pop</span><span style="color: #00ff00;">(</span>
<span class="linenr">65: </span>            np.<span style="color: #006DAF; font-style: italic;">argmin</span><span style="color: #1e90ff;">(</span>
<span class="linenr">66: </span>                np.<span style="color: #D0372D; font-style: italic;">linalg</span>.<span style="color: #006DAF; font-style: italic;">norm</span><span style="color: #ff00ff;">(</span>
<span class="linenr">67: </span>                    topnodes<span style="color: #ff8c00;">[</span>i<span style="color: #ff8c00;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span><span style="color: #0000FF;">-</span>np.<span style="color: #006DAF; font-style: italic;">array</span><span style="color: #ff8c00;">(</span><span style="color: #00ffff;">[</span>botnodes<span style="color: #32cd32;">[</span>j<span style="color: #32cd32;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span>
<span class="linenr">68: </span>                                                      <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">j</span> <span style="color: #0000FF;">in</span> botleft<span style="color: #00ffff;">]</span><span style="color: #ff8c00;">)</span>,
<span class="linenr">69: </span>                    <span style="color: #808080;">axis</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1</span><span style="color: #ff00ff;">)</span>
<span class="linenr">70: </span>            <span style="color: #1e90ff;">)</span>
<span class="linenr">71: </span>        <span style="color: #00ff00;">)</span>
<span class="linenr">72: </span>    <span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">73: </span>
<span class="linenr">74: </span><span style="color: #8D8D84; font-style: italic;"># Adjust Nodes on Bottom Beam Interface to Match Top Beam Exactly</span>
<span class="linenr">75: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">76: </span>    ras.<span style="color: #006DAF; font-style: italic;">editNode</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">nodes</span><span style="color: #0000FF;">=</span>botnodes<span style="color: #00ff00;">[</span>bts<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>:bts<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span><span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">]</span>,
<span class="linenr">77: </span>                 <span style="color: #808080;">coordinates</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span>topnodes<span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">]</span>.<span style="color: #D0372D; font-style: italic;">coordinates</span>,<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">78: </span>
</pre>
</div></li>
</ol></li>
<li><p>
Create node sets for the top, bottom and relative coordinates.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">79: </span><span style="color: #BA36A5;">botpairednds</span> <span style="color: #0000FF;">=</span> botnodes.<span style="color: #006DAF; font-style: italic;">sequenceFromLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>botnodes<span style="color: #ff00ff;">[</span>i<span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> bts<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">80: </span><span style="color: #8D8D84; font-style: italic;"># Reordering from the sorting above</span>
<span class="linenr">81: </span>
<span class="linenr">82: </span>ras.<span style="color: #6434A3; font-style: italic;">SetFromNodeLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"TOPS_NDS"</span>, 
<span class="linenr">83: </span>                      <span style="color: #808080;">nodeLabels</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>topnodes<span style="color: #ff00ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">instanceName</span>, 
<span class="linenr">84: </span>                                   <span style="color: #006FE0;">tuple</span><span style="color: #ff00ff;">(</span><span style="color: #ff8c00;">[</span>topnodes<span style="color: #00ffff;">[</span>i<span style="color: #00ffff;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff;">(</span><span style="color: #D0372D;">N</span><span style="color: #00ffff;">)</span><span style="color: #ff8c00;">]</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">85: </span>                      <span style="color: #808080;">unsorted</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">86: </span>ras.<span style="color: #6434A3; font-style: italic;">SetFromNodeLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"BOTS_NDS"</span>, 
<span class="linenr">87: </span>                      <span style="color: #808080;">nodeLabels</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>botpairednds<span style="color: #ff00ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">instanceName</span>, 
<span class="linenr">88: </span>                                   <span style="color: #ff00ff;">[</span>botpairednds<span style="color: #ff8c00;">[</span>i<span style="color: #ff8c00;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff8c00;">(</span><span style="color: #D0372D;">N</span><span style="color: #ff8c00;">)</span><span style="color: #ff00ff;">]</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">89: </span>                      <span style="color: #808080;">unsorted</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">90: </span><span style="color: #BA36A5;">rlcn</span> <span style="color: #0000FF;">=</span> ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'RELCSET'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #D0372D; font-style: italic;">nodes</span>
<span class="linenr">91: </span>ras.<span style="color: #6434A3; font-style: italic;">SetFromNodeLabels</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"RELCSET"</span>,
<span class="linenr">92: </span>                      <span style="color: #808080;">nodeLabels</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>rlcn<span style="color: #ff00ff;">[</span><span style="color: #D0372D;">0</span><span style="color: #ff00ff;">]</span>.<span style="color: #D0372D; font-style: italic;">instanceName</span>,
<span class="linenr">93: </span>                                   <span style="color: #ff00ff;">[</span>rlcn<span style="color: #ff8c00;">[</span>i<span style="color: #ff8c00;">]</span>.<span style="color: #D0372D; font-style: italic;">label</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #ff8c00;">(</span><span style="color: #D0372D;">N</span><span style="color: #ff8c00;">)</span><span style="color: #ff00ff;">]</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">94: </span>                      <span style="color: #808080;">unsorted</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
We now set equation constraints to set a meaning for the ghost nodes.
It is possible to provide sets as inputs to the Equation constraint (each node is taken as-ordered).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">95: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">3</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">96: </span>    mdl.<span style="color: #6434A3; font-style: italic;">Equation</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'RELCS-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #00ff00;">)</span>,
<span class="linenr">97: </span>                 <span style="color: #808080;">terms</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1.0</span>, <span style="color: #008000;">'TOPS_NDS'</span>, i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span>,
<span class="linenr">98: </span>                        <span style="color: #1e90ff;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.0</span>, <span style="color: #008000;">'RELCSET'</span>, i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span>,
<span class="linenr">99: </span>                        <span style="color: #1e90ff;">(</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">1.0</span>, <span style="color: #008000;">'BOTS_NDS'</span>, i<span style="color: #0000FF;">+</span><span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div>
<p>
The constraint represented by the above is
\[ u^{(i)}_{RELCSET} = u^{(i)}_{TOP} - u^{(i)}_{BOT} \implies
   u^{(i)}_{TOP} - u^{(i)}_{RELCSET} - u^{(i)}_{BOT} = 0 \]
</p></li>
<li><p>
We next setup the "fixed interface" CMS by conducting a Frequency step while constraining all the DOFS of the <code>RELCSET</code> nodeset to be zero (interface stuck against each other).
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">100: </span>mdl.<span style="color: #6434A3; font-style: italic;">FrequencyStep</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>, <span style="color: #808080;">previous</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Initial"</span>,
<span class="linenr">101: </span>                  <span style="color: #808080;">normalization</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MASS</span>, <span style="color: #808080;">eigensolver</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">LANCZOS</span>,
<span class="linenr">102: </span>                  <span style="color: #808080;">numEigen</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">60</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">103: </span>mdl.<span style="color: #6434A3; font-style: italic;">EncastreBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"RELFIX"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>,
<span class="linenr">104: </span>               <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'RELCSET'</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
The substructuring step is finally setup.
We request 6 more modes in <code>modeRange</code> since the "fixedInterface= model will have 6 Rigid Body Modes which don't add anything to model accuracy.
So if 20 generalized modes are desired, we ask for 26. 
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">105: </span>mdl.<span style="color: #6434A3; font-style: italic;">SubstructureGenerateStep</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>, <span style="color: #808080;">previous</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"Fixed-Int-Modal"</span>,
<span class="linenr">106: </span>                             <span style="color: #808080;">substructureIdentifier</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1</span>, 
<span class="linenr">107: </span>                             <span style="color: #808080;">retainedEigenmodesMethod</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">MODE_RANGE</span>,
<span class="linenr">108: </span>                             <span style="color: #808080;">modeRange</span><span style="color: #0000FF;">=</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">26</span>, <span style="color: #D0372D;">1</span><span style="color: #1e90ff;">)</span>,<span style="color: #00ff00;">)</span>,
<span class="linenr">109: </span>                             <span style="color: #808080;">recoveryMatrix</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">REGION</span>,
<span class="linenr">110: </span>                             <span style="color: #808080;">recoveryRegion</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'OUTNODES'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">111: </span>                             <span style="color: #808080;">computeReducedMassMatrix</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">True</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">112: </span>
<span class="linenr">113: </span>mdl.<span style="color: #6434A3; font-style: italic;">RetainedNodalDofsBC</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"A"</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>,
<span class="linenr">114: </span>                        <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'RELCSET'</span><span style="color: #00ff00;">]</span>,
<span class="linenr">115: </span>                        <span style="color: #808080;">u1</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u2</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span>, <span style="color: #808080;">u3</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">ON</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">116: </span>
<span class="linenr">117: </span><span style="color: #8D8D84; font-style: italic;"># Apply Bolt Loads (1N magnitude)</span>
<span class="linenr">118: </span><span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #00ffff; font-weight: bold;">)</span>:
<span class="linenr">119: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'BoltLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>,
<span class="linenr">120: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">1.0</span>, <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'BPT-%d_SET-1'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">121: </span>    mdl.<span style="color: #6434A3; font-style: italic;">ConcentratedForce</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'NutLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #00ff00;">(</span>i<span style="color: #00ff00;">)</span>, <span style="color: #808080;">createStepName</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMS"</span>,
<span class="linenr">122: </span>                          <span style="color: #808080;">cf3</span><span style="color: #0000FF;">=-</span><span style="color: #D0372D;">1.0</span>, <span style="color: #808080;">region</span><span style="color: #0000FF;">=</span>ras.<span style="color: #D0372D; font-style: italic;">sets</span><span style="color: #00ff00;">[</span><span style="color: #008000;">'NPT-%d_SET-1'</span> <span style="color: #0000FF;">%</span><span style="color: #1e90ff;">(</span>i<span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">123: </span>
<span class="linenr">124: </span><span style="color: #BA36A5;">sbs</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">steps</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'HCBCMS'</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">125: </span>sbs.<span style="color: #6434A3; font-style: italic;">LoadCase</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"LCASE"</span>, <span style="color: #808080;">loads</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #008000;">'BoltLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, <span style="color: #D0372D;">1.0</span><span style="color: #1e90ff;">)</span>
<span class="linenr">126: </span>                                       <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span> <span style="color: #0000FF;">+</span>
<span class="linenr">127: </span>             <span style="color: #006FE0;">tuple</span><span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span><span style="color: #008000;">'NutLoad-%d'</span> <span style="color: #0000FF;">%</span><span style="color: #ff00ff;">(</span>i<span style="color: #ff00ff;">)</span>, <span style="color: #D0372D;">1.0</span><span style="color: #1e90ff;">)</span> <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">4</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
We complete the task by requesting matrix output and outputting node and element information.
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="linenr">128: </span><span style="color: #8D8D84; font-style: italic;"># ABAQUS CAE doesn't support this yet (GUI or scripting),</span>
<span class="linenr">129: </span><span style="color: #8D8D84; font-style: italic;"># so the keywords need to be manually modified.</span>
<span class="linenr">130: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">synchVersions</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">storeNodesAndElements</span><span style="color: #0000FF;">=</span><span style="color: #006FE0;">False</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">131: </span><span style="color: #BA36A5;">li</span> <span style="color: #0000FF;">=</span> np.<span style="color: #006DAF; font-style: italic;">argwhere</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #1e90ff;">[</span>i<span style="color: #1e90ff;">][</span><span style="color: #D0372D;">0</span>:<span style="color: #D0372D;">20</span><span style="color: #1e90ff;">]</span> <span style="color: #0000FF;">==</span> <span style="color: #008000;">"*Retained Nodal Dofs"</span>
<span class="linenr">132: </span>                  <span style="color: #0000FF;">for</span> <span style="color: #BA36A5;">i</span> <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #1e90ff;">(</span><span style="color: #006FE0;">len</span><span style="color: #ff00ff;">(</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #ff00ff;">)</span><span style="color: #1e90ff;">)</span><span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)[</span><span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">][</span><span style="color: #D0372D;">0</span><span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">133: </span><span style="color: #BA36A5;">txi</span> <span style="color: #0000FF;">=</span> mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #00ffff; font-weight: bold;">[</span>li<span style="color: #00ffff; font-weight: bold;">]</span>
<span class="linenr">134: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">replace</span><span style="color: #00ffff; font-weight: bold;">(</span>li, <span style="color: #008000;">"*Retained Nodal Dofs, sorted=NO"</span><span style="color: #0000FF;">+</span>txi<span style="color: #00ff00;">[</span><span style="color: #D0372D;">20</span>:<span style="color: #00ff00;">]</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">135: </span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #006DAF; font-style: italic;">insert</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #006FE0;">len</span><span style="color: #00ff00;">(</span>mdl.<span style="color: #D0372D; font-style: italic;">keywordBlock</span>.<span style="color: #D0372D; font-style: italic;">sieBlocks</span><span style="color: #00ff00;">)</span><span style="color: #0000FF;">-</span><span style="color: #D0372D;">2</span>, 
<span class="linenr">136: </span>                        "<span style="color: #0000FF;">*</span><span style="color: #6434A3;">Substructure</span> <span style="color: #6434A3;">Matrix</span> <span style="color: #6434A3;">Output</span>, <span style="color: #D0372D;">FILE</span> <span style="color: #808080;">NAME</span><span style="color: #0000FF;">=</span><span style="color: #6434A3;">Modelmats</span>,
<span class="linenr">137: </span>                        <span style="color: #808080;">MASS</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">YES</span>, <span style="color: #808080;">STIFFNESS</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">YES</span>, <span style="color: #808080;">SLOAD</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">YES</span>, <span style="color: #808080;">RECOVERY</span> <span style="color: #D0372D;">MATRIX</span><span style="color: #0000FF;">=</span><span style="color: #D0372D;">YES</span>"<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">138: </span>
<span class="linenr">139: </span><span style="color: #8D8D84; font-style: italic;"># Create a job and write an inp file</span>
<span class="linenr">140: </span>mdb.<span style="color: #6434A3; font-style: italic;">Job</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #808080;">name</span><span style="color: #0000FF;">=</span><span style="color: #008000;">"HCBCMSJob"</span>, <span style="color: #808080;">model</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'Model-1'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">141: </span>mdb.<span style="color: #D0372D; font-style: italic;">jobs</span><span style="color: #00ffff; font-weight: bold;">[</span><span style="color: #008000;">'HCBCMSJob'</span><span style="color: #00ffff; font-weight: bold;">]</span>.<span style="color: #006DAF; font-style: italic;">writeInput</span><span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">142: </span>
<span class="linenr">143: </span><span style="color: #8D8D84; font-style: italic;"># Save interfacial nodes &amp; elements to txt files</span>
<span class="linenr">144: </span>np.<span style="color: #006DAF; font-style: italic;">savetxt</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Nodes.dat'</span>, <span style="color: #6434A3;">TopNdCds</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #8D8D84; font-style: italic;"># Save to dat file</span>
<span class="linenr">145: </span>np.<span style="color: #006DAF; font-style: italic;">savetxt</span><span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Elements.dat'</span>, <span style="color: #D0372D;">ELS</span>, <span style="color: #808080;">fmt</span><span style="color: #0000FF;">=</span><span style="color: #008000;">'%d'</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li>The inp file "HCBCMSJob.inp" can be run just as before, and it will generate an mtx file named "Modelmats.mtx".</li>
<li>The script <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/readwritematvec.sh">readwritematvec.sh</a> can be used to post process this mtx file just as before.</li>
</ol>
</div>
</div>
<div id="outline-container-orgcaaa996" class="outline-3">
<h3 id="orgcaaa996"><span class="section-number-3">7.3.</span> Nonlinear Prestress Analysis with MATLAB/OCTAVE</h3>
<div class="outline-text-3" id="text-7-3">
<ol class="org-ol">
<li>The same MATLAB/OCTAVE routines from <a href="cref:sec:nlan">cref:sec:nlan</a> can be used here, with minor tweaks to account for the fact that the model is already in the relative coordinates frame.</li>
<li><p>
Everything in the preamble is identical to before:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>clc
<span class="linenr"> 2: </span>clear all
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultAxesTickLabelInterpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'default'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 5: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultTextInterpreter'</span><span style="color: #006FE0;">,</span><span style="color: #008000;">'latex'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 6: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span> <span style="color: #008000;">'DefaultLegendInterpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 7: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>0<span style="color: #006FE0;">,</span><span style="color: #008000;">'defaultAxesFontSize'</span><span style="color: #006FE0;">,</span>13<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Read Nodes and Elements</span>
<span class="linenr">10: </span>Nodes <span style="color: #006FE0;">=</span> dlmread<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./Nodes.dat'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">11: </span>Elements <span style="color: #006FE0;">=</span> dlmread<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./Elements.dat'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">12: </span>N <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Number of nodes per side</span>
<span class="linenr">13: </span>Ne <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Elements<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Number of elements</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Load Matrices</span>
<span class="linenr">16: </span>fname <span style="color: #006FE0;">=</span> <span style="color: #008000;">'./Modelmats.mat'</span><span style="color: #006FE0;">;</span>
<span class="linenr">17: </span>load<span style="color: #00ffff; font-weight: bold;">(</span>fname<span style="color: #006FE0;">,</span> <span style="color: #008000;">'M'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'K'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'R'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Fv'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Number of generalized modal DOFs</span>
<span class="linenr">20: </span>Nint <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>M<span style="color: #006FE0;">,</span>1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">-</span>N<span style="color: #006FE0;">*</span>3<span style="color: #006FE0;">;</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Single-Point-Quadrature Matrices</span>
<span class="linenr">23: </span>Qm <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>Ne<span style="color: #006FE0;">,</span> N<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Each element has one quadrature point</span>
<span class="linenr">24: </span>Tm <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>N<span style="color: #006FE0;">,</span> Ne<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Each quadrature pt integrated to 4 nodes</span>
<span class="linenr">25: </span>Ars <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>Ne<span style="color: #006FE0;">,</span> 1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Vector of areas of each element</span>
<span class="linenr">26: </span><span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
<span class="linenr">27: </span>    ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
<span class="linenr">28: </span>    Qm<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> ones<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #006FE0;">,</span> 4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">/</span>4<span style="color: #006FE0;">;</span>
<span class="linenr">29: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #8D8D84; font-style: italic;">% value @ QP = avg of nodal values</span>
<span class="linenr">30: </span>             
<span class="linenr">31: </span>    Ars<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> polyarea<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>2<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">32: </span>
<span class="linenr">33: </span>    Tm<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ei<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> ones<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #006FE0;">,</span> 1<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">*</span>Ars<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">/</span>4<span style="color: #006FE0;">;</span>
<span class="linenr">34: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #8D8D84; font-style: italic;">% (integrated) nodal value = value @ QP times element Area/4</span>
<span class="linenr">35: </span><span style="color: #0000FF;">end</span>
<span class="linenr">36: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Qm is quadrature interpolation matrix</span>
<span class="linenr">37: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Tm is quadrature integration matrix</span>
<span class="linenr">38: </span>
<span class="linenr">39: </span>Ar_tot <span style="color: #006FE0;">=</span> 120e<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">*</span>25.4e<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">-</span>3<span style="color: #006FE0;">*</span>pi<span style="color: #006FE0;">*</span><span style="color: #00ffff; font-weight: bold;">(</span>0.85e<span style="color: #006FE0;">-</span>2<span style="color: #006FE0;">/</span>2<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">^</span>2<span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% True total area</span>
<span class="linenr">40: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>   <span style="color: #8D8D84; font-style: italic;">% Rectangle-3*Circles</span>
<span class="linenr">41: </span>Ar_avg <span style="color: #006FE0;">=</span> Ar_tot<span style="color: #006FE0;">/</span>Ne<span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Average element area</span>
</pre>
</div></li>
<li><p>
Since the DOFs are already relative displacements, we directly use the Quadrature matrices for the extraction:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">42: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Contact Relative Displacements (DOFS already in relative coordinates</span>
<span class="linenr">43: </span>Lz <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>kron<span style="color: #00ff00;">(</span>Qm<span style="color: #006FE0;">,</span> <span style="color: #1e90ff;">[</span>0 0 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span> zeros<span style="color: #00ff00;">(</span>Ne<span style="color: #006FE0;">,</span> Nint<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get only normal displacement</span>
<span class="linenr">44: </span>Gz <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>kron<span style="color: #00ff00;">(</span>Tm<span style="color: #006FE0;">,</span> <span style="color: #1e90ff;">[</span>0<span style="color: #006FE0;">;</span> 0<span style="color: #006FE0;">;</span> 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #006FE0;">;</span> zeros<span style="color: #00ff00;">(</span>Nint<span style="color: #006FE0;">,</span> Ne<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span>
<span class="linenr">45: </span>
<span class="linenr">46: </span><span style="color: #8D8D84;">% </span><span style="color: #8D8D84; font-style: italic;">Nodal relative disp (only for plotting)</span>
<span class="linenr">47: </span>Lz_n <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">[</span>kron<span style="color: #00ff00;">(</span>eye<span style="color: #1e90ff;">(</span>N<span style="color: #1e90ff;">)</span><span style="color: #006FE0;">,</span> <span style="color: #1e90ff;">[</span>0 0 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span> zeros<span style="color: #00ff00;">(</span>N<span style="color: #006FE0;">,</span> Nint<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">]</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get only normal displacement</span>
</pre>
</div></li>
<li><p>
Just as before, we use the null-space to get a well-posed formulation, and then conduct the nonlinear prestress analysis (<code>RESFUN.m</code> is the same as before).
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">48: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Remove fixed interface null-space</span>
<span class="linenr">49: </span>L1 <span style="color: #006FE0;">=</span> null<span style="color: #00ffff; font-weight: bold;">(</span>Lz<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">50: </span><span style="color: #00ffff; font-weight: bold;">[</span>V<span style="color: #006FE0;">,</span>D<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> eigs<span style="color: #00ffff; font-weight: bold;">(</span>L1<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>L1<span style="color: #006FE0;">,</span> L1<span style="color: #006FE0;">'*</span>M<span style="color: #006FE0;">*</span>L1<span style="color: #006FE0;">,</span> 20<span style="color: #006FE0;">,</span> <span style="color: #008000;">'SM'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% Get first 20 modes</span>
<span class="linenr">51: </span>Ln <span style="color: #006FE0;">=</span> null<span style="color: #00ffff; font-weight: bold;">(</span>V<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span> 1<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">'*</span>L1<span style="color: #006FE0;">'*</span>M<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% First six modes are RBMs</span>
<span class="linenr">52: </span>
<span class="linenr">53: </span>Nn <span style="color: #006FE0;">=</span> size<span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">,</span> 2<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Null-reduced DOFs</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Solve the Nonlinear Static Prestress Problem</span>
<span class="linenr">56: </span>bpmag <span style="color: #006FE0;">=</span> 12e3<span style="color: #006FE0;">;</span>
<span class="linenr">57: </span>knl <span style="color: #006FE0;">=</span> 5e6<span style="color: #006FE0;">/</span><span style="color: #00ffff; font-weight: bold;">(</span>Ar_tot<span style="color: #006FE0;">/</span>Ne<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> <span style="color: #8D8D84; font-style: italic;">% knl divided by avg element area</span>
<span class="linenr">58: </span>U0 <span style="color: #006FE0;">=</span> <span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>Ln <span style="color: #006FE0;">+</span> <span style="color: #00ff00;">(</span>Gz<span style="color: #006FE0;">'*</span>Ln<span style="color: #00ff00;">)</span><span style="color: #006FE0;">'*</span><span style="color: #00ff00;">(</span>Lz<span style="color: #006FE0;">*</span>Ln<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>knl<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">\</span><span style="color: #00ffff; font-weight: bold;">(</span>Ln<span style="color: #006FE0;">'*</span>Fv<span style="color: #006FE0;">*</span>bpmag<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">59: </span>
<span class="linenr">60: </span>opt <span style="color: #006FE0;">=</span> optimoptions<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'fsolve'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'specifyObjectiveGradient'</span><span style="color: #006FE0;">,</span> true<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">61: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>  <span style="color: #008000;">'Display'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'iter'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">62: </span><span style="color: #00ffff; font-weight: bold;">[</span>U0<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">~,</span> <span style="color: #006FE0;">~,</span> <span style="color: #006FE0;">~,</span> J0<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> fsolve<span style="color: #00ffff; font-weight: bold;">(</span>@<span style="color: #00ff00;">(</span>U<span style="color: #00ff00;">)</span> RESFUN<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>U<span style="color: #006FE0;">;</span> bpmag<span style="color: #1e90ff;">]</span><span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>K<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">63: </span>    <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #c05fc05fc05f;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #b2abbe16c887;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #acccc887b7e3;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f924cd19accc;"> </span>   <span style="color: #f6dcb8dedacd;"> </span>  Ln<span style="color: #006FE0;">'*</span>Fv<span style="color: #006FE0;">,</span> Lz<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>Gz<span style="color: #006FE0;">,</span> knl<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> U0<span style="color: #006FE0;">,</span> opt<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">64: </span>                                     
<span class="linenr">65: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Linearized Modal Analysis</span>
<span class="linenr">66: </span><span style="color: #00ffff; font-weight: bold;">[</span>V0<span style="color: #006FE0;">,</span> D0<span style="color: #00ffff; font-weight: bold;">]</span> <span style="color: #006FE0;">=</span> eigs<span style="color: #00ffff; font-weight: bold;">(</span>J0<span style="color: #006FE0;">,</span> Ln<span style="color: #006FE0;">'*</span>M<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">,</span> 10<span style="color: #006FE0;">,</span> <span style="color: #008000;">'SM'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">67: </span>W0 <span style="color: #006FE0;">=</span> sqrt<span style="color: #00ffff; font-weight: bold;">(</span>diag<span style="color: #00ff00;">(</span>D0<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">68: </span>disp<span style="color: #00ffff; font-weight: bold;">(</span>table<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>10<span style="color: #1e90ff;">)</span><span style="color: #006FE0;">',</span> W0<span style="color: #006FE0;">/</span>2<span style="color: #006FE0;">/</span>pi<span style="color: #006FE0;">,</span> <span style="color: #008000;">'VariableNames'</span><span style="color: #006FE0;">,</span> <span style="color: #1e90ff;">{</span><span style="color: #008000;">'Index'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Frequency (Hz)'</span><span style="color: #1e90ff;">}</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li><p>
Here is the results of the linearized modal analysis:   
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Index</th>
<th scope="col" class="org-right">Frequency (Hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">143.74</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">151.3</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">575.05</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">642.77</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">870.5</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">945.57</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1130.3</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1475.6</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1700.1</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1896.2</td>
</tr>
</tbody>
</table>
<p>
Comparing this with the predictions from before indicate a very close agreement.
</p></li>
</ol>
</div>
<div id="outline-container-orgc1213a9" class="outline-4">
<h4 id="orgc1213a9"><span class="section-number-4">7.3.1.</span> Plotting Results</h4>
<div class="outline-text-4" id="text-7-3-1">
<ol class="org-ol">
<li><p>
We use the following modified version of the plotting code to visualize the response:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Depict Interfacial Displacement Field</span>
<span class="linenr"> 2: </span>A <span style="color: #006FE0;">=</span> zeros<span style="color: #00ffff; font-weight: bold;">(</span>N<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Graph adjacency matrix</span>
<span class="linenr"> 3: </span><span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
<span class="linenr"> 4: </span>    <span style="color: #c05fc05fc05f;"> </span>  ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
<span class="linenr"> 5: </span>    <span style="color: #c05fc05fc05f;"> </span>  A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #006FE0;">,</span> ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">+</span> eye<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 6: </span>    <span style="color: #c05fc05fc05f;"> </span>  A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">=</span> A<span style="color: #00ffff; font-weight: bold;">(</span>ndis<span style="color: #00ff00;">(</span><span style="color: #1e90ff;">[</span>2<span style="color: #006FE0;">:</span>end 1<span style="color: #1e90ff;">]</span><span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> ndis<span style="color: #00ffff; font-weight: bold;">)</span> <span style="color: #006FE0;">+</span> eye<span style="color: #00ffff; font-weight: bold;">(</span>4<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">end</span>
<span class="linenr"> 8: </span>G <span style="color: #006FE0;">=</span> graph<span style="color: #00ffff; font-weight: bold;">(</span>A<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>figure<span style="color: #00ffff; font-weight: bold;">(</span>1<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">11: </span>pos<span style="color: #006FE0;">=</span>get<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">12: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>pos<span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>2<span style="color: #1e90ff;">)</span> 900 320<span style="color: #00ff00;">]</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Color'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'white'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">13: </span>clf<span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">14: </span>plot<span style="color: #00ffff; font-weight: bold;">(</span>G<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XData'</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'YData'</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span><span style="color: #006FE0;">:,</span>2<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">15: </span>    <span style="color: #c05fc05fc05f;"> </span><span style="color: #008000;">'NodeCData'</span><span style="color: #006FE0;">,</span> Lz_n<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">*</span>U0<span style="color: #006FE0;">,</span> <span style="color: #006FE0;">...</span>
<span class="linenr">16: </span>    <span style="color: #c05fc05fc05f;"> </span><span style="color: #008000;">'MarkerSize'</span><span style="color: #006FE0;">,</span> 4<span style="color: #006FE0;">,</span> <span style="color: #008000;">'LineWidth'</span><span style="color: #006FE0;">,</span> 3<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">17: </span>colormap<span style="color: #00ffff; font-weight: bold;">(</span>jet<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">18: </span>grid on
<span class="linenr">19: </span>axis equal
<span class="linenr">20: </span>axis tight
<span class="linenr">21: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>gca<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XTick'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">(</span><span style="color: #006FE0;">-</span>6<span style="color: #006FE0;">:</span>3<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>1e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">22: </span>xlim<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span><span style="color: #006FE0;">-</span>1 1<span style="color: #00ff00;">]</span><span style="color: #006FE0;">*</span>6e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">23: </span>ylim<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #00ff00;">[</span><span style="color: #006FE0;">-</span>1 1<span style="color: #00ff00;">]</span><span style="color: #006FE0;">*</span>1.27e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">24: </span>xlabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'X Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">25: </span>ylabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Y Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">26: </span>xx<span style="color: #006FE0;">=</span>colorbar<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'SouthOutside'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">27: </span>xlabel<span style="color: #00ffff; font-weight: bold;">(</span>xx<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Nodal Relative Displacement (m)'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'interpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'fontsize'</span><span style="color: #006FE0;">,</span> 13<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span>print<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./intdisps_rc.png'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'-dpng'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'-r300'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span><span style="color: #8D8D84;">%% </span><span style="color: #8D8D84; font-style: italic;">Show Pressure field</span>
<span class="linenr">32: </span>pvals <span style="color: #006FE0;">=</span> max<span style="color: #00ffff; font-weight: bold;">(</span>knl<span style="color: #006FE0;">*</span>Lz<span style="color: #006FE0;">*</span>Ln<span style="color: #006FE0;">*</span>U0<span style="color: #006FE0;">,</span> 0<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% pressure @ QPs</span>
<span class="linenr">33: </span>figure<span style="color: #00ffff; font-weight: bold;">(</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">34: </span>pos<span style="color: #006FE0;">=</span>get<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">35: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>gcf<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Position'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">[</span>pos<span style="color: #1e90ff;">(</span>1<span style="color: #006FE0;">:</span>2<span style="color: #1e90ff;">)</span> 900 320<span style="color: #00ff00;">]</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'Color'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'white'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">36: </span>clf<span style="color: #00ffff; font-weight: bold;">()</span>
<span class="linenr">37: </span><span style="color: #0000FF;">for</span> ei<span style="color: #006FE0;">=</span>1<span style="color: #006FE0;">:</span>Ne
<span class="linenr">38: </span>    ndis <span style="color: #006FE0;">=</span> Elements<span style="color: #00ffff; font-weight: bold;">(</span>ei<span style="color: #006FE0;">,</span> 2<span style="color: #006FE0;">:</span>end<span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>  <span style="color: #8D8D84; font-style: italic;">% Nodes of the current element</span>
<span class="linenr">39: </span>    fill<span style="color: #00ffff; font-weight: bold;">(</span>Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>1<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> Nodes<span style="color: #00ff00;">(</span>ndis<span style="color: #006FE0;">,</span>2<span style="color: #00ff00;">)</span><span style="color: #006FE0;">,</span> pvals<span style="color: #00ff00;">(</span>ei<span style="color: #00ff00;">)</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span> hold on
<span class="linenr">40: </span><span style="color: #0000FF;">end</span>
<span class="linenr">41: </span>colormap<span style="color: #00ffff; font-weight: bold;">(</span>jet<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">42: </span>grid on
<span class="linenr">43: </span>axis equal
<span class="linenr">44: </span>axis tight
<span class="linenr">45: </span>set<span style="color: #00ffff; font-weight: bold;">(</span>gca<span style="color: #006FE0;">,</span> <span style="color: #008000;">'XTick'</span><span style="color: #006FE0;">,</span> <span style="color: #00ff00;">(</span><span style="color: #006FE0;">-</span>6<span style="color: #006FE0;">:</span>3<span style="color: #006FE0;">:</span>6<span style="color: #00ff00;">)</span><span style="color: #006FE0;">*</span>1e<span style="color: #006FE0;">-</span>2<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">46: </span>xlabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'X Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">47: </span>ylabel<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'Y Coordinate (m)'</span><span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">48: </span>xx<span style="color: #006FE0;">=</span>colorbar<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'SouthOutside'</span><span style="color: #00ffff; font-weight: bold;">)</span><span style="color: #006FE0;">;</span>
<span class="linenr">49: </span>xlabel<span style="color: #00ffff; font-weight: bold;">(</span>xx<span style="color: #006FE0;">,</span> <span style="color: #008000;">'Element Normal Pressure (Pa)'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'interpreter'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'latex'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'fontsize'</span><span style="color: #006FE0;">,</span> 13<span style="color: #00ffff; font-weight: bold;">)</span>
<span class="linenr">50: </span>
<span class="linenr">51: </span>print<span style="color: #00ffff; font-weight: bold;">(</span><span style="color: #008000;">'./intpress_rc.png'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'-dpng'</span><span style="color: #006FE0;">,</span> <span style="color: #008000;">'-r300'</span><span style="color: #00ffff; font-weight: bold;">)</span>
</pre>
</div></li>
<li>Here are the results
<ol class="org-ol">
<li><p>
Nodal Displacements:
</p>

<div id="org2a65c6d" class="figure">
<p><img src="./figs/intdisps_rc.png" alt="intdisps_rc.png" width="600px" />
</p>
</div></li>
<li><p>
Interfacial Pressures:
</p>

<div id="org6fdf502" class="figure">
<p><img src="./figs/intpress_rc.png" alt="intpress_rc.png" width="600px" />
</p>
</div></li>
</ol></li>
<li>The results can be seen to be almost nearly identical to those shown before.</li>
<li>Computationally the advantages are clear.
The size of the model matrices with relative coordinates is 2078, while the size without is 4136.
Using the relative DOF-coordinates, therefore, <b>one can achieve an almost 2x reduction in system size</b>, which is beneficial in every form of analysis.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-sec:outro" class="outline-2">
<h2 id="sec:outro"><span class="section-number-2">8.</span> Outro/Contact</h2>
<div class="outline-text-2" id="text-sec:outro">
<p>
You can contact me at <a href="mailto:nidish@iitm.ac.in">nidish@iitm.ac.in</a> or <a href="mailto:nidbid@gmail.com">nidbid@gmail.com</a> for any questions/suggestions.
Don't forget to check out the repository in github at <a href="https://github.com/Nidish96/Abaqus4Joints">https://github.com/Nidish96/Abaqus4Joints</a>.
</p>

<p>
If you found this useful, please consider citing <a href="https://www.sciencedirect.com/science/article/abs/pii/S0888327020300017">this paper</a> and/or <a href="https://scholarship.rice.edu/handle/1911/113700">this thesis</a>.
</p>
</div>
<div id="outline-container-org6242c80" class="outline-3">
<h3 id="org6242c80"><span class="section-number-3">8.1.</span> Summary</h3>
<div class="outline-text-3" id="text-8-1">
<p>
All the scripts used in the tutorial are provided in 
</p>
<ol class="org-ol">
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/a_steelmat.py">a_steelmat.py</a>: Loading material</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/b_halfbm.py">b_halfbm.py</a>: Building the half-beam model</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/c_nutwasherbolt_516.py">c_nutwasherbolt_516.py</a>: Building the bolt, nut, and washer models.</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/d_applyconstraints.py">d_applyconstraints.py</a>: Applying the relevant constraints and introducing bolt prestress.</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/e_nodeproc.py">e_nodeproc.py</a>: The postprocessing script create surface node sets and setting up substructure analysis.</li>
<li>Files <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/d1_relcs.py">d1_relcs.py</a> and <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/e1_relcsnproc.py">e1_relcsnproc.py</a> provide replacements for files 4 &amp; 5 above while using relative coordinates.</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/scripts/readwritematvec.sh">readwritematvec.sh</a>: Contains the mtx reading script written with <code>bash</code> and <code>python</code>.</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/demo/main.m">main.m</a>: Contains the MATLAB/OCTAVE file for doing the nonlinear static prestress analysis (also see <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/demo/RESFUN.m">RESFUN.m</a> for the residue routine).</li>
<li><a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/assets/demo/main_rc.m">main_rc.m</a>: Contains the MATLAB/OCTAVE file for the nonlinear static prestress analysis using the relative coordinates representation.</li>
</ol>

<p>
The <a href="https://github.com/Nidish96/Abaqus4Joints">Github repository</a> has the above scripts as well as all the cae files.
</p>
</div>
</div>
<div id="outline-container-orgcbb1803" class="outline-3">
<h3 id="orgcbb1803"><span class="section-number-3">8.2.</span> Details on this web-page documentation/offering suggestions</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>This website was generated using org-mode on emacs with the Bigblow html theme from
<a href="https://github.com/fniessen/org-html-themes">https://github.com/fniessen/org-html-themes</a>.
The collapsible details blocks from <a href="https://github.com/alhassy/org-special-block-extras">org-special-block-extras</a> have also been used extensively.</li>
<li>The best way to offer suggestions would be to use the <a href="https://github.com/Nidish96/Abaqus4Joints/blob/main/docs/index.pdf">pdf version</a> of the documentation, annotate it and <a href="mailto:nidish.balaji@ila.uni-stuttgart.de">mail it to me</a>.
Alternately, you can also clone the <a href="https://github.com/Nidish96/Abaqus4Joints">repository</a>, make changes and create a pull request.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Nidish Narayanaa Balaji</p>
<p class="date">Created: 2025-03-27 Thu 12:45</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
